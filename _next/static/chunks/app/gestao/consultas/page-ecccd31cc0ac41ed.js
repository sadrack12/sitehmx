(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[9274],{8330:function(e,a,t){Promise.resolve().then(t.bind(t,8017))},8017:function(e,a,t){"use strict";t.r(a),t.d(a,{default:function(){return ec}});var r=t(7437),s=t(2265),o=t(8565),i=t(4033),n=t(5950),l=t(3242),c=t(9224),d=t(3523),u=t(1827),m=t(2482),x=t(7607),h=t(9883),p=t(1138),g=t(8203),f=t(6141),b=t(7972),v=t(8253),j=t(8956),y=t(8339),w=t(3008),N=t(2104),C=t(9670),E=t(8417),k=t(5713),_=t(5073),S=t(6637),A=t(7982),T=t(7619),D=t(3030),P=t(9617),Z=t(290),z=t(1291),I=t(7158),R=t(2894),M=t(2549),O=t(3344),L=t(519),F=t(1981),U=t(6245),q=t(9173);function B(e){let{consulta:a,onClose:t,onSuccess:i}=e,{token:c}=(0,o.a)(),[d,m]=(0,s.useState)(!1),[h,p]=(0,s.useState)([]),[f,b]=(0,s.useState)([]),[v,j]=(0,s.useState)([]),[y,N]=(0,s.useState)([]),[C,E]=(0,s.useState)([]),[k,_]=(0,s.useState)(!1),[S,A]=(0,s.useState)(null),[T,D]=(0,s.useState)(null),[P,Z]=(0,s.useState)(""),[R,B]=(0,s.useState)([]),[W,V]=(0,s.useState)(!1),[J,H]=(0,s.useState)(1),[G,$]=(0,s.useState)([]),[Y,K]=(0,s.useState)(!1),[Q,X]=(0,s.useState)({paciente_id:"",especialidade:"",medico_id:"",sala_id:"",data_consulta:"",hora_consulta:"",tipo_consulta:"",observacoes:""});(0,s.useEffect)(()=>{ee(),ea(),et()},[]),(0,s.useEffect)(()=>{if(""===P.trim())B(h);else{let e=P.toLowerCase();B(h.filter(a=>{var t,r,s,o;return(null===(t=a.nome)||void 0===t?void 0:t.toLowerCase().includes(e))||(null===(r=a.nif)||void 0===r?void 0:r.toLowerCase().includes(e))||(null===(s=a.email)||void 0===s?void 0:s.toLowerCase().includes(e))||(null===(o=a.telefone)||void 0===o?void 0:o.toLowerCase().includes(e))}))}},[P,h]),(0,s.useEffect)(()=>{if(a){var e,t,r;let s=f.find(e=>e.id===a.medico_id),o=h.find(e=>e.id===a.paciente_id);X({paciente_id:(null===(e=a.paciente_id)||void 0===e?void 0:e.toString())||"",especialidade:(null==s?void 0:s.especialidade)||"",medico_id:(null===(t=a.medico_id)||void 0===t?void 0:t.toString())||"",sala_id:(null===(r=a.sala_id)||void 0===r?void 0:r.toString())||"",data_consulta:a.data_consulta||"",hora_consulta:a.hora_consulta||"",tipo_consulta:a.tipo_consulta||"",observacoes:a.observacoes||""}),o&&Z("".concat(o.nome," - NIF: ").concat(o.nif)),s&&A({id:s.id,nome:s.nome,crm:s.crm}),a.sala&&D(a.sala),(null==s?void 0:s.especialidade)?(es(s.especialidade),er(s.especialidade)):a.medico_id&&eo(a.medico_id.toString())}},[a,f,h]),(0,s.useEffect)(()=>{Q.especialidade&&!a?(es(Q.especialidade),er(Q.especialidade),H(1),D(null)):Q.especialidade||(E([]),A(null),D(null),H(1),N([]))},[Q.especialidade]),(0,s.useEffect)(()=>{Q.paciente_id&&Q.especialidade&&Q.data_consulta&&!a?en(Q.paciente_id,Q.especialidade,Q.data_consulta):$([])},[Q.paciente_id,Q.especialidade,Q.data_consulta]),(0,s.useEffect)(()=>{!Q.medico_id||Q.especialidade||a||eo(Q.medico_id)},[Q.medico_id]);let ee=async()=>{try{let e=await fetch("".concat("https://clamatec.com/api","/pacientes"),{headers:{Authorization:"Bearer ".concat(c)}});if(e.ok){let a=await e.json(),t=a.data||a||[];p(t),B(t)}}catch(e){console.error("Erro ao buscar pacientes:",e)}},ea=async()=>{try{let e=await fetch("".concat("https://clamatec.com/api","/medicos"),{headers:{Authorization:"Bearer ".concat(c)}});if(e.ok){let a=await e.json(),t=Array.isArray(a)?a:a.data||[];b(t)}else console.error("Erro ao buscar m\xe9dicos:",e.statusText)}catch(e){console.error("Erro ao buscar m\xe9dicos:",e)}},et=async()=>{try{let e=await fetch("".concat("https://clamatec.com/api","/admin/especialidades"),{headers:{Authorization:"Bearer ".concat(c)}});if(e.ok){let a=await e.json(),t=Array.isArray(a)?a:a.data||[];j(t.filter(e=>!1!==e.ativo))}}catch(e){console.error("Erro ao buscar especialidades:",e)}},er=async e=>{try{let a="".concat("https://clamatec.com/api","/admin/salas-consultas");e&&(a+="?especialidade=".concat(encodeURIComponent(e)));let t=await fetch(a,{headers:{Authorization:"Bearer ".concat(c)}});if(t.ok){let e=await t.json(),a=Array.isArray(e)?e:e.data||[];N(a.filter(e=>!1!==e.disponivel))}else console.error("Erro ao buscar salas:",t.statusText)}catch(e){console.error("Erro ao buscar salas:",e)}},es=async e=>{try{_(!0);let a=new Date,t=[];for(let r=0;r<3;r++){let s=new Date(a.getFullYear(),a.getMonth()+r,1),o="".concat(s.getFullYear(),"-").concat(String(s.getMonth()+1).padStart(2,"0"));try{let a=await fetch("".concat("https://clamatec.com/api","/especialidade-disponibilidade?especialidade=").concat(encodeURIComponent(e),"&mes=").concat(o),{headers:{Authorization:"Bearer ".concat(c)}});if(a.ok){let e=await a.json();e.data&&Array.isArray(e.data)&&t.push(...e.data)}}catch(e){console.error("Erro ao buscar disponibilidade para o m\xeas ".concat(o,":"),e)}}let r=a.toISOString().split("T")[0],s=t.filter(e=>e.data>=r);s.sort((e,a)=>e.data.localeCompare(a.data)),E(s)}catch(e){console.error("Erro ao buscar disponibilidade:",e),l.A.error("Erro ao buscar datas dispon\xedveis. Tente novamente."),E([])}finally{_(!1)}},eo=async e=>{try{_(!0);let a=new Date,t="".concat(a.getFullYear(),"-").concat(String(a.getMonth()+1).padStart(2,"0")),r=await fetch("".concat("https://clamatec.com/api","/medico-disponibilidade?medico_id=").concat(e,"&mes=").concat(t),{headers:{Authorization:"Bearer ".concat(c)}});if(r.ok){let e=await r.json();E(e.data||[])}else console.error("Erro ao buscar disponibilidade:",r.statusText),E([])}catch(e){console.error("Erro ao buscar disponibilidade:",e),E([])}finally{_(!1)}},ei=async(e,a)=>{if(a&&a.length>0){let t=a[Math.floor(Math.random()*a.length)];A(t),X({...Q,data_consulta:e,medico_id:t.id.toString()})}else X({...Q,data_consulta:e,medico_id:""}),A(null);D(null),Q.paciente_id&&Q.especialidade&&await en(Q.paciente_id,Q.especialidade,e)},en=async(e,a,t)=>{try{K(!0);let r=await fetch("".concat("https://clamatec.com/api","/verificar-consulta-existente"),{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(c)},body:JSON.stringify({paciente_id:parseInt(e),especialidade:a,data_consulta:t})});if(r.ok){let e=await r.json();e.existe&&e.consulta?$([e.consulta]):$([])}}catch(e){console.error("Erro ao verificar consultas em aberto:",e)}finally{K(!1)}},el=async e=>{if(e.preventDefault(),G.length>0&&!a){l.A.error("O paciente j\xe1 possui uma consulta agendada desta especialidade para esta data. Verifique as consultas em aberto antes de continuar.");return}m(!0);try{let e=a?"".concat("https://clamatec.com/api","/consultas/").concat(a.id):"".concat("https://clamatec.com/api","/consultas"),t={paciente_id:parseInt(Q.paciente_id),data_consulta:Q.data_consulta,hora_consulta:Q.hora_consulta||null,tipo_consulta:Q.tipo_consulta,observacoes:Q.observacoes||null};Q.medico_id?t.medico_id=parseInt(Q.medico_id):Q.especialidade&&(t.especialidade=Q.especialidade),Q.especialidade&&!t.especialidade&&(t.especialidade=Q.especialidade);let r=await fetch(e,{method:a?"PUT":"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(c)},body:JSON.stringify(t)});if(!r.ok){let e=await r.json(),a=e.errors?Object.values(e.errors).flat().join(", "):e.message||"Erro ao salvar consulta";throw Error(a)}let s=await r.json();s.sala&&D(s.sala),l.A.success(a?"Consulta atualizada com sucesso!":"Consulta criada com sucesso!"),setTimeout(()=>i(),500)}catch(e){l.A.error(e.message||"Erro ao salvar consulta")}finally{m(!1)}};return(0,r.jsx)("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/50",children:(0,r.jsxs)("div",{className:"bg-white rounded-lg shadow-lg max-w-2xl w-full max-h-[90vh] overflow-y-auto",children:[(0,r.jsxs)("div",{className:"border-b border-gray-200 px-6 py-4 flex justify-between items-center sticky top-0 bg-white z-10",children:[(0,r.jsx)("h2",{className:"text-lg font-semibold text-gray-900",children:a?"Editar Consulta":"Nova Consulta"}),(0,r.jsx)("button",{onClick:t,className:"text-gray-400 hover:text-gray-600 transition-colors",children:(0,r.jsx)(M.Z,{className:"w-5 h-5"})})]}),(0,r.jsxs)("form",{onSubmit:el,className:"p-6 space-y-4",children:[(0,r.jsxs)(q.Z,{label:"Tipo de Consulta",value:Q.tipo_consulta,onChange:e=>X({...Q,tipo_consulta:e.target.value}),required:!0,children:[(0,r.jsx)("option",{value:"",children:"Selecione o tipo"}),(0,r.jsx)("option",{value:"Consulta Geral",children:"Consulta Geral"}),(0,r.jsx)("option",{value:"Consulta de Especialidade",children:"Consulta de Especialidade"}),(0,r.jsx)("option",{value:"Retorno",children:"Retorno"}),(0,r.jsx)("option",{value:"Avalia\xe7\xe3o",children:"Avalia\xe7\xe3o"})]}),(0,r.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,r.jsxs)("div",{children:[(0,r.jsxs)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["Paciente ",(0,r.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,r.jsxs)("div",{className:"relative",children:[(0,r.jsx)(u.Z,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-gray-400 z-10"}),(0,r.jsx)("input",{type:"text",value:P,onChange:e=>{Z(e.target.value),V(!0),R.find(a=>"".concat(a.nome," - NIF: ").concat(a.nif)===e.target.value)||X({...Q,paciente_id:""})},onFocus:()=>{V(!0),P||B(h)},onBlur:()=>{setTimeout(()=>V(!1),200)},placeholder:"Buscar e selecionar paciente (nome, NIF, email ou telefone)...",className:"w-full pl-10 pr-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500 outline-none text-sm"}),W&&R.length>0&&(0,r.jsx)("div",{className:"absolute z-20 w-full mt-1 bg-white border border-gray-300 rounded-lg shadow-lg max-h-60 overflow-y-auto",children:R.map(e=>{let a="".concat(e.nome," - NIF: ").concat(e.nif),t=Q.paciente_id===e.id.toString();return(0,r.jsx)("div",{className:"px-4 py-2 cursor-pointer hover:bg-green-50 transition-colors ".concat(t?"bg-green-100 border-l-4 border-green-500":""),onMouseDown:t=>{t.preventDefault(),X({...Q,paciente_id:e.id.toString()}),Z(a),V(!1)},children:(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("div",{className:"font-medium text-gray-900 text-sm",children:e.nome}),(0,r.jsxs)("div",{className:"text-xs text-gray-500",children:["NIF: ",e.nif]})]}),t&&(0,r.jsx)(w.Z,{className:"w-4 h-4 text-green-600"})]})},e.id)})}),W&&P&&0===R.length&&(0,r.jsx)("div",{className:"absolute z-20 w-full mt-1 bg-white border border-gray-300 rounded-lg shadow-lg p-4 text-sm text-gray-500 text-center",children:"Nenhum paciente encontrado"})]}),(0,r.jsx)("input",{type:"hidden",value:Q.paciente_id,required:!0}),Q.paciente_id&&(0,r.jsxs)("p",{className:"text-xs text-green-600 mt-1 flex items-center gap-1",children:[(0,r.jsx)(w.Z,{className:"w-3 h-3"}),"Paciente selecionado"]})]}),(0,r.jsxs)(q.Z,{label:"Especialidade",value:Q.especialidade,onChange:e=>{X({...Q,especialidade:e.target.value,medico_id:"",data_consulta:"",sala_id:""}),A(null),D(null)},required:!0,icon:(0,r.jsx)(O.Z,{className:"w-4 h-4"}),children:[(0,r.jsx)("option",{value:"",children:"Selecione uma especialidade"}),v.map(e=>(0,r.jsx)("option",{value:e.nome,children:e.nome},e.id))]})]}),Q.especialidade&&(0,r.jsxs)("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:[(0,r.jsxs)("div",{className:"flex items-center gap-2 mb-3",children:[(0,r.jsx)(g.Z,{className:"w-4 h-4 text-blue-600"}),(0,r.jsx)("h3",{className:"text-sm font-semibold text-blue-900",children:"Datas Dispon\xedveis"})]}),k?(0,r.jsxs)("div",{className:"flex items-center gap-2 text-sm text-blue-700",children:[(0,r.jsx)(L.Z,{className:"w-4 h-4 animate-spin"}),"Carregando datas dispon\xedveis..."]}):0===C.length?(0,r.jsxs)("div",{className:"flex items-center gap-2 text-sm text-amber-700",children:[(0,r.jsx)(F.Z,{className:"w-4 h-4"}),(0,r.jsx)("span",{children:"Nenhuma data dispon\xedvel para esta especialidade"})]}):(0,r.jsx)(r.Fragment,{children:(()=>{let e=Math.ceil(C.length/5),a=(J-1)*5,t=C.slice(a,a+5);return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("div",{className:"grid grid-cols-5 gap-1.5",children:t.map(e=>{let a=Q.data_consulta===e.data,t=new Date().toISOString().split("T")[0],s=e.data<t;return(0,r.jsx)("div",{className:"p-2 rounded-md border transition-all cursor-pointer ".concat(a?"bg-green-100 border-green-500 shadow-sm":s?"bg-gray-100 border-gray-300 opacity-50 cursor-not-allowed":"bg-white border-blue-200 hover:border-blue-400 hover:shadow-sm"),onClick:()=>{s||ei(e.data,e.medicos_disponiveis||e.medicos||[])},children:(0,r.jsxs)("div",{className:"flex flex-col items-center text-center",children:[(0,r.jsx)("span",{className:"text-[10px] font-medium mb-0.5 ".concat(a?"text-green-700":"text-gray-600"),children:(0,n.p6)(e.data,"EEEE").substring(0,3)}),(0,r.jsx)("span",{className:"text-xs font-semibold mb-0.5 ".concat(a?"text-green-800":"text-gray-900"),children:(0,n.p6)(e.data,"dd/MM")}),(0,r.jsxs)("div",{className:"flex flex-col items-center gap-0.5 mt-0.5",children:[(0,r.jsx)("span",{className:"text-[9px] px-1 py-0.5 rounded ".concat(0===e.vagas_disponiveis?"bg-red-100 text-red-700":e.vagas_disponiveis<3?"bg-yellow-100 text-yellow-700":"bg-green-100 text-green-700"),children:e.vagas_disponiveis||0}),e.medicos_disponiveis&&e.medicos_disponiveis.length>0&&(0,r.jsxs)("span",{className:"text-[9px] text-gray-500",children:[e.medicos_disponiveis.length," m\xe9d."]})]}),a&&(0,r.jsx)(w.Z,{className:"w-3 h-3 text-green-600 mt-0.5"})]})},e.data)})}),e>1&&(0,r.jsxs)("div",{className:"flex items-center justify-between mt-3 pt-3 border-t border-blue-200",children:[(0,r.jsxs)("button",{type:"button",onClick:()=>H(Math.max(1,J-1)),disabled:1===J,className:"flex items-center gap-1 px-3 py-1.5 rounded-md text-sm font-medium transition-colors ".concat(1===J?"bg-gray-100 text-gray-400 cursor-not-allowed":"bg-white text-blue-700 border border-blue-300 hover:bg-blue-50"),children:[(0,r.jsx)(z.Z,{className:"w-4 h-4"}),"Anterior"]}),(0,r.jsxs)("span",{className:"text-sm text-blue-700 font-medium",children:["P\xe1gina ",J," de ",e]}),(0,r.jsxs)("button",{type:"button",onClick:()=>H(Math.min(e,J+1)),disabled:J===e,className:"flex items-center gap-1 px-3 py-1.5 rounded-md text-sm font-medium transition-colors ".concat(J===e?"bg-gray-100 text-gray-400 cursor-not-allowed":"bg-white text-blue-700 border border-blue-300 hover:bg-blue-50"),children:["Pr\xf3xima",(0,r.jsx)(I.Z,{className:"w-4 h-4"})]})]})]})})()})]}),S&&(0,r.jsx)("div",{className:"bg-green-50 border border-green-300 rounded-lg p-4",children:(0,r.jsxs)("div",{className:"flex items-center gap-3",children:[(0,r.jsx)("div",{className:"bg-green-100 p-2 rounded-lg",children:(0,r.jsx)(x.Z,{className:"w-5 h-5 text-green-700"})}),(0,r.jsxs)("div",{children:[(0,r.jsx)("div",{className:"text-xs font-medium text-green-700 uppercase tracking-wide mb-1",children:"M\xe9dico Atribu\xeddo"}),(0,r.jsxs)("div",{className:"text-sm font-semibold text-green-900",children:[S.nome,S.crm&&(0,r.jsxs)("span",{className:"text-green-700 font-normal ml-2",children:["(N\xba Ordem: ",S.crm,")"]})]})]})]})}),T&&(0,r.jsx)("div",{className:"bg-blue-50 border border-blue-300 rounded-lg p-4",children:(0,r.jsxs)("div",{className:"flex items-center gap-3",children:[(0,r.jsx)("div",{className:"bg-blue-100 p-2 rounded-lg",children:(0,r.jsx)(g.Z,{className:"w-5 h-5 text-blue-700"})}),(0,r.jsxs)("div",{children:[(0,r.jsx)("div",{className:"text-xs font-medium text-blue-700 uppercase tracking-wide mb-1",children:"Sala Atribu\xedda Automaticamente"}),(0,r.jsxs)("div",{className:"text-sm font-semibold text-blue-900",children:[T.numero,T.nome&&(0,r.jsxs)("span",{className:"text-blue-700 font-normal ml-2",children:["- ",T.nome]})]})]})]})}),G.length>0&&!a&&(0,r.jsx)("div",{className:"bg-amber-50 border border-amber-300 rounded-lg p-4",children:(0,r.jsxs)("div",{className:"flex items-start gap-3",children:[(0,r.jsx)(F.Z,{className:"w-5 h-5 text-amber-600 mt-0.5 flex-shrink-0"}),(0,r.jsxs)("div",{className:"flex-1",children:[(0,r.jsx)("div",{className:"text-sm font-semibold text-amber-900 mb-2",children:"Consulta em Aberto Encontrada"}),(0,r.jsxs)("p",{className:"text-sm text-amber-800 mb-3",children:["O paciente j\xe1 possui uma consulta agendada da especialidade ",(0,r.jsx)("strong",{children:Q.especialidade})," para o dia ",(0,r.jsx)("strong",{children:(0,n.p6)(Q.data_consulta,"dd/MM/yyyy")}),"."]}),G.map(e=>{var a;return(0,r.jsx)("div",{className:"bg-white rounded-md p-3 border border-amber-200 mb-2",children:(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("div",{className:"text-sm font-medium text-gray-900",children:(null===(a=e.medico)||void 0===a?void 0:a.nome)||"M\xe9dico n\xe3o atribu\xeddo"}),(0,r.jsxs)("div",{className:"text-xs text-gray-600 mt-1",children:[e.sala?"Sala: ".concat(e.sala.numero):"Sala n\xe3o atribu\xedda"," • Status: ",e.status]})]}),(0,r.jsx)("span",{className:"px-2 py-1 rounded text-xs font-medium ".concat("agendada"===e.status?"bg-yellow-100 text-yellow-700":"confirmada"===e.status?"bg-blue-100 text-blue-700":"bg-gray-100 text-gray-700"),children:e.status})]})},e.id)}),(0,r.jsx)("p",{className:"text-xs text-amber-700 mt-2",children:"⚠️ N\xe3o ser\xe1 poss\xedvel criar uma nova consulta da mesma especialidade para esta data."})]})]})}),Q.especialidade&&Q.data_consulta&&!T&&y.length>0&&0===G.length&&(0,r.jsxs)("div",{className:"bg-gray-50 border border-gray-200 rounded-lg p-3 text-sm text-gray-600",children:[(0,r.jsx)(F.Z,{className:"w-4 h-4 inline mr-2"}),"A sala ser\xe1 atribu\xedda automaticamente ao salvar a consulta, baseada nas vagas dispon\xedveis para ",Q.especialidade]}),!Q.data_consulta&&(0,r.jsxs)("div",{children:[(0,r.jsxs)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Data ",(0,r.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,r.jsx)("input",{type:"date",value:Q.data_consulta,onChange:e=>X({...Q,data_consulta:e.target.value}),required:!0,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-1 focus:ring-green-500 focus:border-green-500 outline-none text-sm"})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Observa\xe7\xf5es"}),(0,r.jsx)("textarea",{value:Q.observacoes,onChange:e=>X({...Q,observacoes:e.target.value}),rows:3,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-1 focus:ring-green-500 focus:border-green-500 outline-none resize-none text-sm",placeholder:"Observa\xe7\xf5es..."})]}),(0,r.jsxs)("div",{className:"flex gap-2 justify-end pt-4 border-t border-gray-200",children:[(0,r.jsx)("button",{type:"button",onClick:t,className:"px-4 py-2 border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors text-sm font-medium",children:"Cancelar"}),(0,r.jsx)("button",{type:"submit",disabled:d,className:"px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 disabled:opacity-50 transition-colors text-sm font-medium flex items-center gap-2",children:d?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(L.Z,{className:"w-4 h-4 animate-spin"}),"Salvando..."]}):(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(U.Z,{className:"w-4 h-4"}),a?"Atualizar":"Salvar"]})})]})]})]})})}var W=t(6568),V=t(1397),J=t(6264);function H(e){var a,t;let{consulta:i,onClose:c,onSuccess:d,inline:m=!1}=e,{token:x}=(0,o.a)(),[h,p]=(0,s.useState)([]),[g,b]=(0,s.useState)([]),[v,j]=(0,s.useState)(""),[y,N]=(0,s.useState)(!0),[C,E]=(0,s.useState)(!1),[k,_]=(0,s.useState)([]),[S,A]=(0,s.useState)([]),[T,P]=(0,s.useState)(!0),[Z,z]=(0,s.useState)({observacoes:"",urgente:!1});(0,s.useEffect)(()=>{I(),R()},[i.id]),(0,s.useEffect)(()=>{if(""===v.trim())b(h);else{let e=v.toLowerCase();b(h.filter(a=>{var t,r;return a.nome.toLowerCase().includes(e)||(null===(t=a.codigo)||void 0===t?void 0:t.toLowerCase().includes(e))||(null===(r=a.descricao)||void 0===r?void 0:r.toLowerCase().includes(e))}))}},[v,h]);let I=async()=>{try{N(!0);let e=await fetch("".concat("https://clamatec.com/api","/admin/exames"),{headers:{Authorization:"Bearer ".concat(x)}});if(e.ok){let a=await e.json(),t=(a.data||a||[]).filter(e=>e.ativo&&"laboratorio"===e.tipo);p(t),b(t)}else l.A.error("Erro ao carregar exames")}catch(e){console.error("Erro ao buscar exames:",e),l.A.error("Erro ao carregar exames")}finally{N(!1)}},R=async()=>{try{P(!0);let e=await fetch("".concat("https://clamatec.com/api","/admin/laboratorio?consulta_id=").concat(i.id),{headers:{Authorization:"Bearer ".concat(x)}});if(e.ok){let a=await e.json(),t=a.data||a||[];A(t)}}catch(e){console.error("Erro ao buscar hist\xf3rico:",e)}finally{P(!1)}},O=e=>{_(a=>a.includes(e)?a.filter(a=>a!==e):[...a,e])},L=async e=>{if(e.preventDefault(),0===k.length){l.A.error("Selecione pelo menos um exame");return}if(!(null==i?void 0:i.id)){console.error("Consulta ID n\xe3o encontrado:",i),l.A.error("Erro: ID da consulta n\xe3o encontrado");return}E(!0);try{var a,t,r,s;if(k.length>1){let e={consulta_id:i.id,paciente_id:i.paciente_id||(null===(a=i.paciente)||void 0===a?void 0:a.id),medico_solicitante_id:i.medico_id||(null===(t=i.medico)||void 0===t?void 0:t.id),data_solicitacao:new Date().toISOString().split("T")[0],data_prevista_realizacao:null,observacoes:Z.observacoes,urgente:Z.urgente,exames:k},r=await fetch("".concat("https://clamatec.com/api","/admin/laboratorio"),{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(x)},body:JSON.stringify(e)});if(r.ok)await r.json(),l.A.success("".concat(k.length," exame(s) solicitado(s) em massa com sucesso!")),await R(),d(),c();else{let e=await r.json();l.A.error(e.message||"Erro ao solicitar exames em massa")}}else{let e={consulta_id:i.id,paciente_id:i.paciente_id||(null===(r=i.paciente)||void 0===r?void 0:r.id),exame_id:k[0],medico_solicitante_id:i.medico_id||(null===(s=i.medico)||void 0===s?void 0:s.id),data_solicitacao:new Date().toISOString().split("T")[0],data_prevista_realizacao:null,observacoes:Z.observacoes,urgente:Z.urgente,status:"solicitado"},a=await fetch("".concat("https://clamatec.com/api","/admin/laboratorio"),{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(x)},body:JSON.stringify(e)});if(a.ok)l.A.success("Exame solicitado com sucesso!"),await R(),d(),c();else{let e=await a.json();l.A.error(e.message||"Erro ao solicitar exame")}}}catch(e){console.error("Erro ao solicitar exames:",e),l.A.error("Erro ao solicitar exames")}finally{E(!1)}},U=(0,r.jsxs)("div",{className:"".concat(m?"w-full h-full":"bg-white rounded-lg max-w-2xl w-full max-h-[90vh]"," overflow-y-auto"),children:[!m&&(0,r.jsxs)("div",{className:"p-6 border-b border-gray-200 flex items-center justify-between",children:[(0,r.jsxs)("div",{className:"flex items-center gap-3",children:[(0,r.jsx)(D.Z,{className:"w-6 h-6 text-blue-600"}),(0,r.jsx)("h2",{className:"text-xl font-bold text-gray-900",children:"Solicitar Exames Laboratoriais"})]}),(0,r.jsx)("button",{onClick:c,className:"p-2 text-gray-400 hover:text-gray-600 hover:bg-gray-100 rounded transition-colors",children:(0,r.jsx)(M.Z,{className:"w-5 h-5"})})]}),(0,r.jsxs)("form",{onSubmit:L,className:"".concat(m?"p-4":"p-6"," space-y-4"),children:[(0,r.jsxs)("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4 mb-4",children:[(0,r.jsx)("h3",{className:"text-sm font-semibold text-blue-900 mb-2",children:"Informa\xe7\xf5es da Consulta"}),(0,r.jsxs)("div",{className:"grid grid-cols-2 gap-3 text-sm",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("span",{className:"text-blue-700 font-medium",children:"Paciente:"}),(0,r.jsx)("span",{className:"ml-2 text-blue-900",children:null===(a=i.paciente)||void 0===a?void 0:a.nome})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("span",{className:"text-blue-700 font-medium",children:"M\xe9dico:"}),(0,r.jsx)("span",{className:"ml-2 text-blue-900",children:null===(t=i.medico)||void 0===t?void 0:t.nome})]})]})]}),S.length>0&&(0,r.jsxs)("div",{className:"bg-gray-50 border border-gray-200 rounded-lg p-4 mb-4",children:[(0,r.jsxs)("div",{className:"flex items-center gap-2 mb-3",children:[(0,r.jsx)(f.Z,{className:"w-4 h-4 text-gray-600"}),(0,r.jsxs)("h3",{className:"text-sm font-semibold text-gray-900",children:["Hist\xf3rico de Exames Solicitados (",S.length,")"]})]}),T?(0,r.jsx)("div",{className:"flex items-center justify-center py-2",children:(0,r.jsx)(J.Z,{className:"w-4 h-4 animate-spin text-gray-400"})}):(0,r.jsx)("div",{className:"space-y-2 max-h-32 overflow-y-auto",children:S.map(e=>{var a;return(0,r.jsxs)("div",{className:"flex items-start justify-between bg-white border border-gray-200 rounded p-2 text-xs",children:[(0,r.jsxs)("div",{className:"flex-1",children:[(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsx)("span",{className:"font-medium text-gray-900",children:(null===(a=e.exame)||void 0===a?void 0:a.nome)||"Exame"}),e.urgente&&(0,r.jsxs)("span",{className:"px-1.5 py-0.5 rounded text-xs font-medium bg-red-100 text-red-800 flex items-center gap-1",children:[(0,r.jsx)(F.Z,{className:"w-2.5 h-2.5"}),"Urgente"]})]}),(0,r.jsxs)("div",{className:"text-gray-500 mt-0.5",children:[(0,n.p6)(e.data_solicitacao,"dd/MM/yyyy")," •"," ",(0,r.jsx)("span",{className:"capitalize",children:e.status})]})]}),(0,r.jsx)("div",{className:"ml-2",children:"concluido"===e.status?(0,r.jsx)(w.Z,{className:"w-4 h-4 text-green-600"}):(0,r.jsx)(f.Z,{className:"w-4 h-4 text-yellow-600"})})]},e.id)})})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Exames Laboratoriais * (Selecione um ou mais)"}),y?(0,r.jsx)("div",{className:"flex items-center justify-center py-4",children:(0,r.jsx)(J.Z,{className:"w-5 h-5 animate-spin text-gray-400"})}):(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("div",{className:"mb-3",children:(0,r.jsxs)("div",{className:"relative",children:[(0,r.jsx)(u.Z,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-gray-400"}),(0,r.jsx)("input",{type:"text",value:v,onChange:e=>j(e.target.value),placeholder:"Buscar por nome, c\xf3digo ou descri\xe7\xe3o...",className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 text-sm"})]})}),(0,r.jsx)("div",{className:"border border-gray-300 rounded-lg max-h-48 overflow-y-auto",children:0===g.length?(0,r.jsx)("div",{className:"p-4 text-center text-gray-500 text-sm",children:v?"Nenhum exame encontrado":"Nenhum exame laboratorial dispon\xedvel"}):(0,r.jsx)("div",{className:"divide-y divide-gray-200",children:g.map(e=>{let a=k.includes(e.id),t=S.some(a=>a.exame_id===e.id);return(0,r.jsx)("div",{className:"p-2 cursor-pointer transition-colors ".concat(a?"bg-blue-50 border-l-4 border-blue-600":t?"bg-yellow-50 border-l-4 border-yellow-400":"hover:bg-gray-50"),onClick:()=>O(e.id),children:(0,r.jsxs)("div",{className:"flex items-start gap-2",children:[(0,r.jsx)("input",{type:"checkbox",checked:a,onChange:()=>O(e.id),className:"mt-0.5 w-3.5 h-3.5 text-blue-600 border-gray-300 rounded focus:ring-blue-500",onClick:e=>e.stopPropagation()}),(0,r.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,r.jsxs)("div",{className:"flex items-center gap-1.5",children:[(0,r.jsx)("span",{className:"font-medium text-gray-900 text-sm",children:e.nome}),e.codigo&&(0,r.jsxs)("span",{className:"text-xs text-gray-500",children:["(",e.codigo,")"]}),t&&(0,r.jsxs)("span",{className:"text-xs text-yellow-700 font-medium flex items-center gap-1",children:[(0,r.jsx)(f.Z,{className:"w-3 h-3"}),"J\xe1 solicitado"]})]}),e.descricao&&(0,r.jsx)("p",{className:"text-xs text-gray-600 mt-0.5 line-clamp-1",children:e.descricao}),(0,r.jsxs)("div",{className:"flex items-center gap-2 mt-1 text-xs text-gray-500",children:[e.requer_jejum&&(0,r.jsxs)("div",{className:"flex items-center gap-0.5 text-orange-600",children:[(0,r.jsx)(F.Z,{className:"w-2.5 h-2.5"}),(0,r.jsx)("span",{children:"Requer jejum"})]}),e.prazo_resultado&&(0,r.jsxs)("span",{children:["Prazo: ",e.prazo_resultado," dia(s)"]})]})]})]})},e.id)})})}),v&&g.length>0&&(0,r.jsxs)("div",{className:"mt-2 text-xs text-gray-500",children:["Mostrando ",g.length," de ",h.length," exames"]})]}),k.length>0&&(0,r.jsxs)("div",{className:"mt-2 text-sm text-gray-600 font-medium",children:[k.length," exame(s) selecionado(s)"]})]}),(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsx)("input",{type:"checkbox",id:"urgente",checked:Z.urgente,onChange:e=>z({...Z,urgente:e.target.checked}),className:"w-4 h-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500"}),(0,r.jsx)("label",{htmlFor:"urgente",className:"text-sm font-medium text-gray-700",children:"Marcar como urgente"})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Observa\xe7\xf5es"}),(0,r.jsx)("textarea",{value:Z.observacoes,onChange:e=>z({...Z,observacoes:e.target.value}),rows:4,placeholder:"Adicione observa\xe7\xf5es sobre a solicita\xe7\xe3o do exame...",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]}),(0,r.jsxs)("div",{className:"flex justify-end gap-3 pt-4 border-t border-gray-200",children:[!m&&(0,r.jsx)("button",{type:"button",onClick:c,className:"px-4 py-2 border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-50 transition-colors",children:"Cancelar"}),(0,r.jsx)("button",{type:"submit",disabled:C||0===k.length,className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-2",children:C?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(J.Z,{className:"w-4 h-4 animate-spin"}),"Solicitando..."]}):(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(D.Z,{className:"w-4 h-4"}),"Solicitar ",k.length>0?"".concat(k.length," "):"","Exame",1!==k.length?"s":""]})})]})]})]});return m?U:(0,r.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:U})}var G=t(4478),$=t(8291);function Y(e){var a,t;let{consulta:i,onClose:c,onSuccess:d}=e,{token:m}=(0,o.a)(),[x,h]=(0,s.useState)(!1),[p,g]=(0,s.useState)(!1),[f,b]=(0,s.useState)([]),[v,j]=(0,s.useState)([]),[y,w]=(0,s.useState)(""),[N,C]=(0,s.useState)(null);(0,s.useEffect)(()=>{E()},[]),(0,s.useEffect)(()=>{if(""===y.trim())j(f);else{let e=y.toLowerCase();j(f.filter(a=>a.nome.toLowerCase().includes(e)||a.nif.toLowerCase().includes(e)))}},[y,f]);let E=async()=>{try{h(!0);let e=await fetch("".concat("https://clamatec.com/api","/pacientes"),{headers:{Authorization:"Bearer ".concat(m)}});if(e.ok){let a=await e.json(),t=(a.data||a||[]).filter(e=>e.id!==i.paciente_id);b(t),j(t)}else l.A.error("Erro ao carregar pacientes")}catch(e){console.error("Erro ao buscar pacientes:",e),l.A.error("Erro ao carregar pacientes")}finally{h(!1)}},k=async e=>{if(e.preventDefault(),!N){l.A.error("Selecione um paciente");return}g(!0);try{let e=await fetch("".concat("https://clamatec.com/api","/consultas/").concat(i.id),{method:"PUT",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(m)},body:JSON.stringify({paciente_id:N.id})});if(e.ok)l.A.success("Vaga transferida com sucesso!"),d(),c();else{let a=await e.json();l.A.error(a.message||"Erro ao transferir vaga")}}catch(e){console.error("Erro ao transferir vaga:",e),l.A.error("Erro ao transferir vaga")}finally{g(!1)}};return(0,r.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:(0,r.jsxs)("div",{className:"bg-white rounded-lg max-w-lg w-full",children:[(0,r.jsxs)("div",{className:"p-4 border-b border-gray-200 flex items-center justify-between",children:[(0,r.jsx)("h2",{className:"text-lg font-bold text-gray-900",children:"Transferir Vaga"}),(0,r.jsx)("button",{onClick:c,className:"p-1 text-gray-400 hover:text-gray-600 hover:bg-gray-100 rounded transition-colors",children:(0,r.jsx)(M.Z,{className:"w-5 h-5"})})]}),(0,r.jsx)("div",{className:"p-4 bg-gray-50 border-b border-gray-200",children:(0,r.jsxs)("div",{className:"text-sm space-y-1",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("span",{className:"text-gray-600 font-medium",children:"Paciente Atual:"}),(0,r.jsx)("span",{className:"ml-2 text-gray-900",children:null===(a=i.paciente)||void 0===a?void 0:a.nome})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("span",{className:"text-gray-600 font-medium",children:"Data/Hora:"}),(0,r.jsxs)("span",{className:"ml-2 text-gray-900",children:[(0,n.p6)(i.data_consulta,"dd/MM/yyyy")," \xe0s ",i.hora_consulta]})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("span",{className:"text-gray-600 font-medium",children:"M\xe9dico:"}),(0,r.jsx)("span",{className:"ml-2 text-gray-900",children:null===(t=i.medico)||void 0===t?void 0:t.nome})]})]})}),(0,r.jsxs)("form",{onSubmit:k,className:"p-4 space-y-3",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Selecionar Novo Paciente *"}),x?(0,r.jsx)("div",{className:"flex items-center justify-center py-4",children:(0,r.jsx)(J.Z,{className:"w-5 h-5 animate-spin text-gray-400"})}):(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("div",{className:"mb-2",children:(0,r.jsxs)("div",{className:"relative",children:[(0,r.jsx)(u.Z,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-gray-400"}),(0,r.jsx)("input",{type:"text",value:y,onChange:e=>w(e.target.value),placeholder:"Buscar por nome ou NIF...",className:"w-full pl-10 pr-4 py-2 text-sm border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500"})]})}),(0,r.jsx)("div",{className:"border border-gray-300 rounded-lg max-h-48 overflow-y-auto",children:0===v.length?(0,r.jsx)("div",{className:"p-4 text-center text-gray-500 text-sm",children:y?"Nenhum paciente encontrado":"Nenhum paciente dispon\xedvel"}):(0,r.jsx)("div",{className:"divide-y divide-gray-200",children:v.map(e=>{let a=(null==N?void 0:N.id)===e.id;return(0,r.jsx)("div",{className:"p-2 cursor-pointer transition-colors ".concat(a?"bg-green-50 border-l-4 border-green-600":"hover:bg-gray-50"),onClick:()=>C(e),children:(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsx)("input",{type:"radio",checked:a,onChange:()=>C(e),className:"w-3.5 h-3.5 text-green-600 border-gray-300 focus:ring-green-500",onClick:e=>e.stopPropagation()}),(0,r.jsxs)("div",{className:"flex-1",children:[(0,r.jsx)("div",{className:"font-medium text-sm text-gray-900",children:e.nome}),(0,r.jsxs)("div",{className:"text-xs text-gray-500",children:["NIF: ",e.nif]})]})]})},e.id)})})})]})]}),(0,r.jsxs)("div",{className:"flex justify-end gap-2 pt-3 border-t border-gray-200",children:[(0,r.jsx)("button",{type:"button",onClick:c,className:"px-3 py-1.5 text-sm border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-50 transition-colors",children:"Cancelar"}),(0,r.jsx)("button",{type:"submit",disabled:p||!N,className:"px-3 py-1.5 text-sm bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-2",children:p?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(J.Z,{className:"w-3.5 h-3.5 animate-spin"}),"Transferindo..."]}):(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)($.Z,{className:"w-3.5 h-3.5"}),"Transferir"]})})]})]})]})})}function K(e){let{isOpen:a,onClose:t,salaId:o,nomeUsuario:i,isMedico:n=!1}=e,l=(0,s.useRef)(null),c=(0,s.useRef)(null),[d,u]=(0,s.useState)(!0),[m,x]=(0,s.useState)(null),[h,p]=(0,s.useState)(!1),[g,f]=(0,s.useState)(!1);return((0,s.useEffect)(()=>{let e=console.error;if(console.error=function(){for(var a=arguments.length,t=Array(a),r=0;r<a;r++)t[r]=arguments[r];let s=t.join(" ");s.includes("NotAllowedError")&&s.includes("user gesture is required")&&(s.includes("AbstractAudio")||s.includes("setting sink")||s.includes("app:media"))||e.apply(console,t)},!a||!l.current||!o)return()=>{console.error=e};if(c.current){try{c.current.dispose()}catch(e){console.log("Erro ao limpar API anterior:",e)}c.current=null}u(!0),x(null),p(!1),f(!1);let r=document.createElement("script");return r.src="https://meet.jit.si/external_api.js",r.async=!0,r.onload=()=>{if(window.JitsiMeetExternalAPI&&l.current)try{let e=n?btoa(o+"_medico_"+Date.now()).substring(0,12):void 0,a={roomName:o,width:"100%",height:"100%",parentNode:l.current,userInfo:{displayName:i},...n&&e?{jwt:void 0}:{},configOverwrite:{...n?{enableWelcomePage:!1,enableClosePage:!1}:{},prejoinPageEnabled:!1,enableWelcomePage:!1,requireDisplayName:!1,startWithAudioMuted:!1,startWithVideoMuted:!1,enableNoAudioDetection:!1,enableNoisyMicDetection:!1,startAudioOnly:!1,disableDeepLinking:!0,enableLayerSuspension:!0,enableRemb:!0,enableTcc:!0,skipPrejoin:!0,skipPrejoinOnMobile:!0,enableAutoJoin:!0,enableAutoJoinOnMobile:!0,hideDisplayName:!1,disableInitialGUM:!1,enableInsecureRoomNameWarning:!1},interfaceConfigOverwrite:{SHOW_JITSI_WATERMARK:!1,SHOW_WATERMARK_FOR_GUESTS:!1,TOOLBAR_BUTTONS:["microphone","camera","closedcaptions","desktop","fullscreen","fodeviceselection","hangup","chat","settings","raisehand","videoquality","filmstrip","feedback","stats","shortcuts","tileview","videobackgroundblur","download","help","mute-everyone","mute-video-everyone"]}};c.current=new window.JitsiMeetExternalAPI("meet.jit.si",a),c.current.addEventListener("videoConferenceJoined",e=>{if(u(!1),console.log("Usu\xe1rio entrou na reuni\xe3o",e),n){let e=()=>{try{var e,a,t,r;let s=(null===(a=c.current)||void 0===a?void 0:null===(e=a.isModerator)||void 0===e?void 0:e.call(a))||!1;if(console.log("\xc9 moderador?",s),s)console.log("✅ M\xe9dico \xe9 moderador/anfitri\xe3o!"),p(!0),f(!1);else{p(!1),f(!0);let e=(null===(r=c.current)||void 0===r?void 0:null===(t=r.getParticipantsInfo)||void 0===t?void 0:t.call(r))||[];console.log("Participantes na sala:",e);let a=e.find(e=>{var a,t;return"moderator"===e.role&&e.participantId!==(null===(t=c.current)||void 0===t?void 0:null===(a=t.getMyUserId)||void 0===a?void 0:a.call(t))});a?(console.log("Outro moderador encontrado:",a),console.log("⚠️ No Jitsi p\xfablico, n\xe3o \xe9 poss\xedvel remover moderador automaticamente"),console.log("\uD83D\uDCA1 Solu\xe7\xe3o: O paciente deve sair e o m\xe9dico entrar primeiro, OU"),console.log("\uD83D\uDCA1 O moderador atual (paciente) deve promover o m\xe9dico manualmente")):(console.log("Nenhum outro moderador encontrado"),console.log("Tentando verificar novamente em 3 segundos..."),setTimeout(()=>{var e,a;(null===(a=c.current)||void 0===a?void 0:null===(e=a.isModerator)||void 0===e?void 0:e.call(a))?(console.log("✅ M\xe9dico agora \xe9 moderador!"),p(!0),f(!1)):(console.log("⚠️ M\xe9dico ainda n\xe3o \xe9 moderador"),console.log("\uD83D\uDCA1 Isso pode acontecer se o paciente entrou primeiro"),console.log("\uD83D\uDCA1 Solu\xe7\xe3o: Pe\xe7a ao paciente para sair e voc\xea entrar primeiro"))},3e3))}}catch(e){console.log("Erro ao verificar/promover moderador:",e)}};e(),setTimeout(e,2e3),setTimeout(e,5e3)}}),c.current.addEventListener("participantRoleChanged",e=>{var a,t;console.log("Papel do participante mudou:",e);let r=null===(t=c.current)||void 0===t?void 0:null===(a=t.getMyUserId)||void 0===a?void 0:a.call(t);(e.id===r||e.participantId===r)&&"moderator"===e.role&&(console.log("✅ Voc\xea foi promovido a moderador/anfitri\xe3o!"),p(!0),f(!1),n&&console.log("✅ M\xe9dico promovido a moderador com sucesso!"))}),c.current.addEventListener("participantJoined",e=>{console.log("Participante entrou:",e)}),c.current.addEventListener("error",e=>{var a,t;(null==e?void 0:e.name)==="NotAllowedError"&&((null==e?void 0:null===(a=e.message)||void 0===a?void 0:a.includes("user gesture is required"))||(null==e?void 0:null===(t=e.message)||void 0===t?void 0:t.includes("setting sink")))||(console.error("Erro no Jitsi:",e),x("Erro ao carregar videoconfer\xeancia. Tente novamente."),u(!1))}),c.current.addEventListener("readyToClose",()=>{c.current&&c.current.dispose(),t()}),setTimeout(()=>{d&&u(!1)},1e4)}catch(e){console.error("Erro ao inicializar Jitsi:",e),x("Erro ao inicializar videoconfer\xeancia: "+(e.message||"Erro desconhecido")),u(!1)}},r.onerror=()=>{x("Erro ao carregar script do Jitsi Meet"),u(!1)},document.body.appendChild(r),()=>{if(console.error=e,c.current){try{c.current.dispose()}catch(e){console.log("Erro ao limpar API:",e)}c.current=null}r.parentNode&&r.parentNode.removeChild(r)}},[a,o,i,t]),a)?(0,r.jsx)("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/90",children:(0,r.jsxs)("div",{className:"relative w-full h-full flex flex-col",children:[(0,r.jsxs)("div",{className:"absolute top-0 left-0 right-0 z-10 bg-gradient-to-b from-black/80 to-transparent px-4 py-3 flex items-center justify-between",children:[(0,r.jsxs)("div",{className:"flex items-center gap-3",children:[(0,r.jsx)(y.Z,{className:"w-5 h-5 text-white"}),(0,r.jsxs)("h2",{className:"text-white font-semibold",children:["Videoconfer\xeancia - ",i]}),n&&h&&(0,r.jsx)("span",{className:"px-2 py-1 bg-green-600 text-white text-xs rounded-full font-semibold",children:"Anfitri\xe3o"})]}),(0,r.jsx)("button",{onClick:t,className:"text-white hover:text-gray-300 transition-colors p-2 hover:bg-white/10 rounded-lg",title:"Fechar",children:(0,r.jsx)(M.Z,{className:"w-6 h-6"})})]}),n&&g&&!h&&(0,r.jsx)("div",{className:"absolute top-16 left-0 right-0 z-20 bg-yellow-600/90 text-white px-4 py-3 mx-4 rounded-lg shadow-lg",children:(0,r.jsxs)("div",{className:"flex items-start gap-3",children:[(0,r.jsx)("div",{className:"flex-shrink-0 mt-0.5",children:(0,r.jsx)("svg",{className:"w-5 h-5",fill:"currentColor",viewBox:"0 0 20 20",children:(0,r.jsx)("path",{fillRule:"evenodd",d:"M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z",clipRule:"evenodd"})})}),(0,r.jsxs)("div",{className:"flex-1",children:[(0,r.jsx)("h3",{className:"font-semibold mb-1",children:"Voc\xea n\xe3o est\xe1 como anfitri\xe3o"}),(0,r.jsx)("p",{className:"text-sm text-yellow-100",children:"No Jitsi, o primeiro usu\xe1rio a entrar se torna anfitri\xe3o automaticamente. Se o paciente entrou primeiro, voc\xea n\xe3o ter\xe1 privil\xe9gios de anfitri\xe3o."}),(0,r.jsx)("p",{className:"text-sm text-yellow-100 mt-2 font-semibold",children:"\uD83D\uDCA1 Solu\xe7\xe3o: Pe\xe7a ao paciente para sair da sala e voc\xea entrar primeiro, ou pe\xe7a ao paciente (anfitri\xe3o atual) para promover voc\xea manualmente nas configura\xe7\xf5es."})]}),(0,r.jsx)("button",{onClick:()=>f(!1),className:"flex-shrink-0 text-yellow-100 hover:text-white transition-colors",title:"Fechar aviso",children:(0,r.jsx)(M.Z,{className:"w-5 h-5"})})]})}),d&&!m&&(0,r.jsx)("div",{className:"absolute inset-0 flex items-center justify-center bg-black z-20",children:(0,r.jsxs)("div",{className:"text-white text-center",children:[(0,r.jsx)(J.Z,{className:"w-12 h-12 animate-spin mx-auto mb-4"}),(0,r.jsx)("p",{className:"text-lg",children:"Carregando videoconfer\xeancia..."}),(0,r.jsx)("p",{className:"text-sm text-gray-400 mt-2",children:'Se for o primeiro a entrar, clique em "Start meeting" quando aparecer'})]})}),m&&(0,r.jsx)("div",{className:"absolute inset-0 flex items-center justify-center bg-black z-20",children:(0,r.jsx)("div",{className:"text-white text-center max-w-md px-4",children:(0,r.jsxs)("div",{className:"bg-red-500/20 border border-red-500 rounded-lg p-6",children:[(0,r.jsx)("p",{className:"text-lg font-semibold mb-2",children:"Erro ao carregar videoconfer\xeancia"}),(0,r.jsx)("p",{className:"text-sm text-gray-300 mb-4",children:m}),(0,r.jsx)("button",{onClick:t,className:"px-4 py-2 bg-red-600 hover:bg-red-700 rounded-lg transition-colors",children:"Fechar"})]})})}),(0,r.jsx)("div",{ref:l,className:"flex-1 w-full h-full"})]})}):null}var Q=t(5750),X=t(7803),ee=t(4043),ea=t(9292),et=t(100);function er(e){var a,o;let{isOpen:i,onClose:n,consultaId:l,nomeUsuario:c,isMedico:d=!1}=e,u=(0,s.useRef)(null),m=(0,s.useRef)(null),x=(0,s.useRef)(!1),[h,p]=(0,s.useState)(!0),[g,f]=(0,s.useState)(null),[b,v]=(0,s.useState)(null),[j,w]=(0,s.useState)(!1),[N,C]=(0,s.useState)([]),[E,k]=(0,s.useState)(!1),[A,D]=(0,s.useState)(!1),[P,Z]=(0,s.useState)("anamnese"),[z,R]=(0,s.useState)(!1),[O,L]=(0,s.useState)(!1),[F,U]=(0,s.useState)(!1),[q,B]=(0,s.useState)(!1),[W,$]=(0,s.useState)(null),[Y,K]=(0,s.useState)([]),[er,es]=(0,s.useState)(!1),[eo,ei]=(0,s.useState)({queixa_principal:"",historia_doenca_atual:"",historia_patologica_pregressa:"",historia_familiar:"",historia_social:"",exame_fisico:"",pressao_arterial:"",frequencia_cardiaca:"",frequencia_respiratoria:"",temperatura:"",peso:"",altura:"",diagnostico:"",conduta:""}),[en,el]=(0,s.useState)(""),[ec,ed]=(0,s.useState)([]),[eu,em]=(0,s.useState)(""),[ex,eh]=(0,s.useState)(!1);(0,s.useEffect)(()=>{i&&l&&d&&(async()=>{try{let e=localStorage.getItem("token"),a=await fetch("".concat("https://clamatec.com/api","/consultas/").concat(l),{headers:{Authorization:"Bearer ".concat(e)}});if(a.ok){let e=await a.json();$(e),e&&(ei({queixa_principal:e.queixa_principal||"",historia_doenca_atual:e.historia_doenca_atual||"",historia_patologica_pregressa:e.historia_patologica_pregressa||"",historia_familiar:e.historia_familiar||"",historia_social:e.historia_social||"",exame_fisico:e.exame_fisico||"",pressao_arterial:e.pressao_arterial||"",frequencia_cardiaca:e.frequencia_cardiaca||"",frequencia_respiratoria:e.frequencia_respiratoria||"",temperatura:e.temperatura||"",peso:e.peso||"",altura:e.altura||"",diagnostico:e.diagnostico||"",conduta:e.conduta||""}),el(e.prescricao||""))}}catch(e){console.error("Erro ao carregar consulta:",e)}})()},[i,l,d]),(0,s.useEffect)(()=>{i&&d&&(async()=>{es(!0);try{let e=localStorage.getItem("token"),a=await fetch("".concat("https://clamatec.com/api","/admin/exames"),{headers:{Authorization:"Bearer ".concat(e)}});if(a.ok){let e=await a.json();K(e.data||e||[])}}catch(e){console.error("Erro ao carregar exames:",e)}finally{es(!1)}})()},[i,d]),(0,s.useEffect)(()=>{if(i&&l)return(async()=>{try{p(!0),f(null);let e=localStorage.getItem("token"),a=await fetch("".concat("https://clamatec.com/api","/daily/consulta/").concat(l,"/room"),{headers:{Authorization:"Bearer ".concat(e)}});if(!a.ok){let e=await a.json();throw Error(e.message||"Erro ao carregar sala")}let t=await a.json();if(v(t),await new Promise(e=>setTimeout(e,300)),!u.current||!u.current.isConnected)throw Error("Container do Daily.co n\xe3o est\xe1 dispon\xedvel. Tente novamente.");if(t.current_user_token&&t.room)await ep(t.room.url,t.current_user_token);else throw Error("Token ou URL da sala n\xe3o dispon\xedvel")}catch(e){console.error("Erro ao carregar sala:",e),f(e.message||"Erro ao carregar videoconfer\xeancia"),p(!1)}})(),()=>{if(m.current){try{m.current.destroy()}catch(e){console.warn("Erro ao destruir Daily.co no cleanup:",e)}et._.unregisterInstance(m.current),m.current=null}u.current&&(u.current.innerHTML="")}},[i,l]);let ep=async(e,a)=>{var r,s,o,i,l,d,h,g,b,v,j;if(x.current){console.warn("Inicializa\xe7\xe3o j\xe1 em andamento, ignorando chamada duplicada");return}{let e=!!(window.RTCPeerConnection||window.webkitRTCPeerConnection||window.mozRTCPeerConnection),a=!!((null===(r=navigator.mediaDevices)||void 0===r?void 0:r.getUserMedia)||navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia);if(!e||!a){f("Seu navegador n\xe3o suporta videoconfer\xeancia (WebRTC). Por favor, use um navegador moderno como Chrome, Firefox, Safari ou Edge."),p(!1),x.current=!1;return}"https:"===window.location.protocol||"localhost"===window.location.hostname||"127.0.0.1"===window.location.hostname||"localhost"===window.location.hostname||"127.0.0.1"===window.location.hostname||console.warn("WebRTC pode n\xe3o funcionar em HTTP. Recomendado usar HTTPS.")}if(et._.isCreating()&&(console.warn("Outra inst\xe2ncia est\xe1 sendo criada, aguardando..."),await new Promise(e=>setTimeout(e,2e3)),et._.isCreating()))throw Error("Outra inst\xe2ncia do Daily.co est\xe1 sendo criada. Aguarde e tente novamente.");x.current=!0,et._.setCreating(!0);try{console.log("Destruindo inst\xe2ncias ativas do Daily.co..."),await et._.destroyActiveInstance(),await new Promise(e=>setTimeout(e,1e3))}catch(e){console.warn("Erro ao destruir inst\xe2ncias ativas:",e)}try{if(m.current){console.log("Destruindo inst\xe2ncia anterior do Daily.co...");try{m.current.destroy(),await new Promise(e=>setTimeout(e,500))}catch(e){console.warn("Erro ao destruir inst\xe2ncia anterior:",e)}et._.unregisterInstance(m.current),m.current=null}if(u.current&&(u.current.innerHTML="",u.current.offsetHeight),await new Promise(e=>setTimeout(e,500)),await new Promise(e=>setTimeout(e,500)),!u.current)throw Error("Container do Daily.co n\xe3o encontrado");if(!u.current.isConnected)throw Error("Container do Daily.co n\xe3o est\xe1 no DOM");let r=u.current.getBoundingClientRect(),x=0;for(;(0===r.width||0===r.height)&&x<5;)console.warn("Container tem dimens\xf5es zero (tentativa ".concat(x+1,"), aguardando...")),await new Promise(e=>setTimeout(e,300)),r=u.current.getBoundingClientRect(),x++;if(0===r.width||0===r.height)throw Error("Container do Daily.co n\xe3o tem dimens\xf5es v\xe1lidas ap\xf3s m\xfaltiplas tentativas");if(console.log("Container pronto:",{width:r.width,height:r.height}),!u.current)throw Error("Container do Daily.co n\xe3o encontrado ap\xf3s inicializa\xe7\xe3o");await new Promise(e=>setTimeout(e,200));let y=await t.e(1878).then(t.bind(t,9204)),N=null;if(y.default&&"function"==typeof y.default.createFrame)N=y.default;else if(y.default&&y.default.default&&"function"==typeof y.default.default.createFrame)N=y.default.default;else if("function"==typeof y.createFrame)N=y;else if("function"==typeof y)N=y;else if(y.DailyIframe&&"function"==typeof y.DailyIframe.createFrame)N=y.DailyIframe;else{let e=Object.keys(y);for(let a of(console.log("Daily.co module keys:",e),console.log("Daily.co module structure:",y),e)){let e=y[a];if(e&&"function"==typeof e.createFrame){N=e;break}}if(!N)throw Error("Daily.co n\xe3o foi carregado corretamente. Estrutura do m\xf3dulo desconhecida.")}if(!N||"function"!=typeof N.createFrame)throw console.error("Daily.co module:",N),console.error("Daily.co type:",typeof N),Error("Daily.co n\xe3o foi carregado corretamente. createFrame n\xe3o encontrado.");if("function"==typeof N.load)try{console.log("Pr\xe9-carregando Daily.co..."),await N.load(),console.log("Daily.co pr\xe9-carregado com sucesso")}catch(e){console.warn("Erro ao pr\xe9-carregar Daily.co (continuando mesmo assim):",e)}if(await new Promise(e=>setTimeout(e,500)),!u.current||!u.current.isConnected)throw Error("Container do Daily.co n\xe3o est\xe1 dispon\xedvel");try{if(u.current){let e=u.current.getBoundingClientRect();if(0===e.width||0===e.height){console.warn("Container tem dimens\xf5es zero, aguardando..."),await new Promise(e=>setTimeout(e,300));let e=u.current.getBoundingClientRect();if(0===e.width||0===e.height)throw Error("Container do Daily.co n\xe3o tem dimens\xf5es v\xe1lidas")}}if(!u.current||!u.current.isConnected)throw Error("Container do Daily.co n\xe3o est\xe1 dispon\xedvel para criar o frame");let e=!1,a=0;for(;!e&&a<3;)try{if(a++,console.log("Tentativa ".concat(a," de criar frame do Daily.co")),!u.current||!u.current.isConnected)throw Error("Container n\xe3o est\xe1 dispon\xedvel");let t=u.current.getBoundingClientRect();if(0===t.width||0===t.height){console.warn("Container ainda sem dimens\xf5es, aguardando..."),await new Promise(e=>setTimeout(e,300));continue}await new Promise(e=>{requestAnimationFrame(()=>{requestAnimationFrame(()=>{e()})})}),u.current.offsetHeight;try{if(!u.current||!u.current.isConnected)throw Error("Container n\xe3o est\xe1 dispon\xedvel antes de criar frame");let a={showLeaveButton:!1,showFullscreenButton:!1,showParticipantsBar:!1,iframeStyle:{position:"absolute",width:"100%",height:"100%",border:"none"}};if(console.log("Criando frame do Daily.co..."),!u.current||!u.current.isConnected)throw Error("Container n\xe3o est\xe1 dispon\xedvel no momento da cria\xe7\xe3o");let t=null;try{m.current=N.createFrame(u.current,a),m.current&&et._.registerInstance(m.current)}catch(e){if((null===(s=e.message)||void 0===s?void 0:s.includes("postMessage"))||(null===(o=e.message)||void 0===o?void 0:o.includes("null"))||(null===(i=e.message)||void 0===i?void 0:i.includes("is not an object"))){if(console.warn("Erro de postMessage durante createFrame (pode ser n\xe3o-cr\xedtico):",e.message),t=e,await new Promise(e=>setTimeout(e,500)),!m.current){console.log("Frame n\xe3o foi criado, tentando novamente...");try{m.current=N.createFrame(u.current,a)}catch(a){throw e}}}else throw e}if(!m.current)throw Error("createFrame retornou null");if(await new Promise(e=>setTimeout(e,500)),!m.current)throw Error("Frame foi destru\xeddo ap\xf3s cria\xe7\xe3o");e=!0,m.current&&et._.registerInstance(m.current),console.log("Frame do Daily.co criado com sucesso"+(t?" (com aviso de postMessage)":""))}catch(a){if(((null===(l=a.message)||void 0===l?void 0:l.includes("postMessage"))||(null===(d=a.message)||void 0===d?void 0:d.includes("null"))||(null===(h=a.message)||void 0===h?void 0:h.includes("is not an object")))&&(console.warn("Erro interno do Daily.co durante createFrame:",a.message),await new Promise(e=>setTimeout(e,500)),m.current)){console.log("Frame foi criado mesmo com erro de postMessage, continuando..."),e=!0;return}throw a}}catch(e){if(console.warn("Erro na tentativa ".concat(a,":"),e.message),a<3&&((null===(g=e.message)||void 0===g?void 0:g.includes("postMessage"))||(null===(b=e.message)||void 0===b?void 0:b.includes("null"))||(null===(v=e.message)||void 0===v?void 0:v.includes("is not an object")))){if(m.current){try{m.current.destroy()}catch(e){}et._.unregisterInstance(m.current),m.current=null}if(u.current&&(u.current.innerHTML="",u.current.offsetHeight),await new Promise(e=>setTimeout(e,1e3*a)),!u.current||!u.current.isConnected)throw Error("Container n\xe3o est\xe1 dispon\xedvel ap\xf3s aguardar")}else throw e}if(!e)throw Error("N\xe3o foi poss\xedvel criar o frame do Daily.co ap\xf3s m\xfaltiplas tentativas");if(!m.current)throw Error("Falha ao criar inst\xe2ncia do Daily.co - retornou null")}catch(e){if(console.error("Erro ao criar frame do Daily.co:",e),e.message&&(e.message.includes("WebRTC")||e.message.includes("not supported"))){let e="Seu navegador n\xe3o suporta videoconfer\xeancia ou o WebRTC est\xe1 bloqueado. Por favor:\n\n1. Use um navegador moderno (Chrome, Firefox, Safari ou Edge)\n2. Verifique se o site est\xe1 acess\xedvel via HTTPS\n3. Permita o acesso \xe0 c\xe2mera e microfone nas configura\xe7\xf5es do navegador\n4. Tente recarregar a p\xe1gina";throw f(e),p(!1),Error(e)}if(e.message&&e.message.includes("postMessage"))throw Error("Erro ao inicializar iframe do Daily.co. Tente fechar e abrir novamente.");throw Error("Erro ao criar frame do Daily.co: "+(e.message||"Erro desconhecido"))}if(m.current.on("loaded",()=>{console.log("Daily.co iframe carregado")}).on("loading",e=>{console.log("Daily.co est\xe1 carregando:",e)}).on("error",e=>{console.error("Erro no Daily.co:",e)}).on("joined-meeting",e=>{var a;console.log("Entrou na reuni\xe3o:",e),console.log("Participantes na reuni\xe3o:",e.participants),console.log("Local participant:",null===(a=e.participants)||void 0===a?void 0:a.local),w(!0),C(e.participants||{}),p(!1),e.participants&&Object.keys(e.participants).forEach(a=>{let t=e.participants[a];t.local||!1!==t.video||console.warn("Participante sem v\xeddeo detectado:",t)})}).on("participant-joined",e=>{var a,t,r,s,o;console.log("Participante entrou:",e),console.log("Participante detalhes:",{user_id:null===(a=e.participant)||void 0===a?void 0:a.user_id,user_name:null===(t=e.participant)||void 0===t?void 0:t.user_name,video:null===(r=e.participant)||void 0===r?void 0:r.video,audio:null===(s=e.participant)||void 0===s?void 0:s.audio,local:null===(o=e.participant)||void 0===o?void 0:o.local}),C(a=>({...a,[e.participant.user_id]:e.participant}))}).on("participant-left",e=>{console.log("Participante saiu:",e),C(a=>{let t={...a};return delete t[e.participant.user_id],t})}).on("error",e=>{console.error("Erro no Daily.co:",e);let a="Erro na videoconfer\xeancia";"account-missing-payment-method"===e.errorMsg?a="A conta Daily.co precisa de um m\xe9todo de pagamento configurado. Entre em contato com o administrador.":"Load failed"===e.errorMsg?a="N\xe3o foi poss\xedvel carregar a videoconfer\xeancia. Verifique sua conex\xe3o e tente novamente.":e.errorMsg?a="Erro na videoconfer\xeancia: "+e.errorMsg:e.message&&(a="Erro na videoconfer\xeancia: "+e.message),f(a),p(!1)}).on("left-meeting",()=>{console.log("Saiu da reuni\xe3o"),w(!1),n()}),!m.current)throw Error("Falha ao criar inst\xe2ncia do Daily.co");if(await new Promise(e=>setTimeout(e,2e3)),!m.current)throw Error("Inst\xe2ncia do Daily.co foi perdida antes do join");if("function"!=typeof m.current.join)throw Error("M\xe9todo join n\xe3o est\xe1 dispon\xedvel no Daily.co");let E="not-loaded";try{"function"==typeof m.current.meetingState&&(E=m.current.meetingState(),console.log("Estado atual da reuni\xe3o:",E))}catch(e){console.warn("N\xe3o foi poss\xedvel verificar o estado da reuni\xe3o:",e)}if("joined-meeting"===E){console.log("J\xe1 est\xe1 na reuni\xe3o, pulando join"),w(!0),p(!1);return}console.log("Tentando entrar na sala:",e),console.log("Token dispon\xedvel:",a?"Sim":"N\xe3o");try{if(await m.current.join({url:e,token:a,userName:c}),console.log("Join realizado com sucesso"),m.current&&"function"==typeof m.current.setLocalVideo)try{await m.current.setLocalVideo(!0),console.log("V\xeddeo local ativado")}catch(e){console.warn("Erro ao ativar v\xeddeo local:",e)}if(m.current&&"function"==typeof m.current.setLocalAudio)try{await m.current.setLocalAudio(!0),console.log("\xc1udio local ativado")}catch(e){console.warn("Erro ao ativar \xe1udio local:",e)}}catch(e){if(console.error("Erro ao fazer join:",e),(null===(j=e.message)||void 0===j?void 0:j.includes("Load failed"))||"Load failed"===e.errorMsg)throw Error("N\xe3o foi poss\xedvel carregar a videoconfer\xeancia. Verifique se a sala existe e o token \xe9 v\xe1lido.");throw e}}catch(e){if(console.error("Erro ao inicializar Daily.co:",e),m.current){try{m.current.destroy()}catch(e){}et._.unregisterInstance(m.current),m.current=null}u.current&&(u.current.innerHTML=""),f("Erro ao inicializar videoconfer\xeancia: "+(e.message||"Erro desconhecido")),p(!1)}finally{x.current=!1,et._.setCreating(!1)}},eg=()=>{if(m.current&&"function"==typeof m.current.leave)try{m.current.leave()}catch(e){console.error("Erro ao sair da chamada:",e)}n()};if(!i)return null;let ef=Object.keys(N).length+(j?1:0);return(0,r.jsx)("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/90",style:{pointerEvents:"auto"},children:(0,r.jsxs)("div",{className:"relative w-full h-full flex flex-col",style:{pointerEvents:"auto",overflow:"hidden"},children:[(0,r.jsxs)("div",{className:"absolute top-0 left-0 right-0 z-50 bg-gradient-to-b from-black/80 to-transparent px-4 py-3 flex items-center justify-between pointer-events-auto",style:{zIndex:100,height:"60px"},children:[(0,r.jsxs)("div",{className:"flex items-center gap-3",children:[(0,r.jsx)(y.Z,{className:"w-5 h-5 text-white"}),(0,r.jsxs)("h2",{className:"text-white font-semibold",children:["Videoconfer\xeancia - ",c]}),d&&(0,r.jsx)("span",{className:"px-2 py-1 bg-green-600 text-white text-xs rounded-full font-semibold",children:"Anfitri\xe3o"}),j&&(0,r.jsxs)("div",{className:"flex items-center gap-2 text-white text-sm",children:[(0,r.jsx)(Q.Z,{className:"w-4 h-4"}),(0,r.jsxs)("span",{children:[ef," ",1===ef?"participante":"participantes"]})]})]}),(0,r.jsxs)("div",{className:"flex items-center gap-2 pointer-events-auto",children:[d&&j&&(0,r.jsxs)("button",{onClick:()=>R(!z),className:"px-3 py-2 rounded-lg transition-colors bg-green-600 hover:bg-green-700 text-white pointer-events-auto cursor-pointer flex items-center gap-2 font-medium shadow-lg",title:z?"Ocultar Painel":"Mostrar Painel de Consulta",children:[(0,r.jsx)(S.Z,{className:"w-5 h-5"}),(0,r.jsx)("span",{className:"text-sm",children:"Consulta"})]}),j&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("button",{onClick:()=>{if(m.current&&"function"==typeof m.current.setLocalAudio)try{let e=m.current.localAudio();m.current.setLocalAudio(!e),k(!e)}catch(e){console.error("Erro ao alternar \xe1udio:",e)}},className:"p-2 rounded-lg transition-colors pointer-events-auto cursor-pointer ".concat(E?"bg-red-600 hover:bg-red-700 text-white":"bg-white/20 hover:bg-white/30 text-white"),title:E?"Ativar microfone":"Desativar microfone",children:E?(0,r.jsx)(X.Z,{className:"w-5 h-5"}):(0,r.jsx)(ee.Z,{className:"w-5 h-5"})}),(0,r.jsx)("button",{onClick:()=>{if(m.current&&"function"==typeof m.current.setLocalVideo)try{let e=m.current.localVideo();m.current.setLocalVideo(!e),D(!e)}catch(e){console.error("Erro ao alternar v\xeddeo:",e)}},className:"p-2 rounded-lg transition-colors pointer-events-auto cursor-pointer ".concat(A?"bg-red-600 hover:bg-red-700 text-white":"bg-white/20 hover:bg-white/30 text-white"),title:A?"Ativar c\xe2mera":"Desativar c\xe2mera",children:A?(0,r.jsx)(ea.Z,{className:"w-5 h-5"}):(0,r.jsx)(y.Z,{className:"w-5 h-5"})})]}),j&&(0,r.jsxs)("button",{onClick:eg,className:"px-4 py-2 bg-red-600 hover:bg-red-700 text-white rounded-lg transition-colors pointer-events-auto cursor-pointer font-semibold flex items-center gap-2",title:"Terminar Reuni\xe3o",children:[(0,r.jsx)(M.Z,{className:"w-4 h-4"}),(0,r.jsx)("span",{children:"Sair"})]}),!j&&(0,r.jsx)("button",{onClick:eg,className:"text-white hover:text-gray-300 transition-colors p-2 hover:bg-white/10 rounded-lg pointer-events-auto cursor-pointer",title:"Fechar",children:(0,r.jsx)(M.Z,{className:"w-6 h-6"})})]})]}),h&&!g&&(0,r.jsx)("div",{className:"absolute inset-0 flex items-center justify-center bg-black z-20",style:{marginTop:"60px",height:"calc(100% - 60px)"},children:(0,r.jsxs)("div",{className:"text-white text-center",children:[(0,r.jsx)(J.Z,{className:"w-12 h-12 animate-spin mx-auto mb-4"}),(0,r.jsx)("p",{className:"text-lg",children:"Carregando videoconfer\xeancia..."}),(0,r.jsx)("p",{className:"text-sm text-gray-400 mt-2",children:"Conectando \xe0 sala Daily.co..."})]})}),g&&(0,r.jsx)("div",{className:"absolute inset-0 flex items-center justify-center bg-black z-20",children:(0,r.jsx)("div",{className:"text-white text-center max-w-md px-4",children:(0,r.jsxs)("div",{className:"bg-red-500/20 border border-red-500 rounded-lg p-6",children:[(0,r.jsx)("p",{className:"text-lg font-semibold mb-2",children:"Erro ao carregar videoconfer\xeancia"}),(0,r.jsx)("p",{className:"text-sm text-gray-300 mb-4",children:g}),(0,r.jsxs)("div",{className:"flex gap-3 justify-center",children:[(0,r.jsx)("button",{onClick:()=>{f(null),p(!0),window.location.reload()},className:"px-4 py-2 bg-blue-600 hover:bg-blue-700 rounded-lg transition-colors",children:"Tentar Novamente"}),(0,r.jsx)("button",{onClick:n,className:"px-4 py-2 bg-red-600 hover:bg-red-700 rounded-lg transition-colors",children:"Fechar"})]})]})})}),(0,r.jsxs)("div",{className:"flex-1 w-full relative flex",style:{marginTop:"60px",height:"calc(100% - 60px)",zIndex:1},children:[(0,r.jsx)("div",{ref:u,className:"flex-1 relative transition-all duration-300 ".concat(""),style:{width:z&&d?"calc(100% - 600px)":"100%",maxWidth:z&&d?"calc(100% - 600px)":"100%",height:"100%",zIndex:1,pointerEvents:"auto",position:"relative"}}),d&&j&&(0,r.jsx)("div",{className:"absolute top-0 right-0 h-full bg-white shadow-2xl transition-transform duration-300 z-20 ".concat(z?"translate-x-0":"translate-x-full"),style:{width:"600px"},children:(0,r.jsxs)("div",{className:"h-full flex flex-col",children:[(0,r.jsxs)("div",{className:"sticky top-0 bg-white border-b border-gray-200 z-10",children:[(0,r.jsxs)("div",{className:"px-6 py-4 flex items-center justify-between",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("h3",{className:"text-lg font-bold text-gray-900",children:"Consulta"}),(0,r.jsx)("p",{className:"text-sm text-gray-600",children:"Preencha durante a consulta"})]}),(0,r.jsx)("button",{onClick:()=>R(!1),className:"text-gray-400 hover:text-gray-600 transition-colors",children:(0,r.jsx)(I.Z,{className:"w-5 h-5"})})]}),(0,r.jsxs)("div",{className:"flex border-b border-gray-200",children:[(0,r.jsxs)("button",{onClick:()=>Z("anamnese"),className:"flex-1 px-4 py-2 text-sm font-medium transition-colors ".concat("anamnese"===P?"text-green-600 border-b-2 border-green-600":"text-gray-600 hover:text-gray-900"),children:[(0,r.jsx)(S.Z,{className:"w-4 h-4 inline mr-2"}),"Anamnese"]}),(0,r.jsxs)("button",{onClick:()=>Z("prescricao"),className:"flex-1 px-4 py-2 text-sm font-medium transition-colors ".concat("prescricao"===P?"text-green-600 border-b-2 border-green-600":"text-gray-600 hover:text-gray-900"),children:[(0,r.jsx)(_.Z,{className:"w-4 h-4 inline mr-2"}),"Prescri\xe7\xe3o"]}),(0,r.jsxs)("button",{onClick:()=>Z("exames"),className:"flex-1 px-4 py-2 text-sm font-medium transition-colors ".concat("exames"===P?"text-green-600 border-b-2 border-green-600":"text-gray-600 hover:text-gray-900"),children:[(0,r.jsx)(T.Z,{className:"w-4 h-4 inline mr-2"}),"Exames"]})]})]}),(0,r.jsxs)("div",{className:"flex-1 overflow-y-auto",children:["anamnese"===P&&W&&(0,r.jsx)(V.Z,{consulta:W,inline:!0,onClose:()=>{},onSuccess:()=>{(async()=>{try{let e=localStorage.getItem("token"),a=await fetch("".concat("https://clamatec.com/api","/consultas/").concat(l),{headers:{Authorization:"Bearer ".concat(e)}});if(a.ok){let e=await a.json();$(e)}}catch(e){console.error("Erro ao recarregar consulta:",e)}})()}}),"prescricao"===P&&W&&(0,r.jsx)(G.Z,{consulta:W,inline:!0,onClose:()=>{},onSuccess:()=>{(async()=>{try{let e=localStorage.getItem("token"),a=await fetch("".concat("https://clamatec.com/api","/consultas/").concat(l),{headers:{Authorization:"Bearer ".concat(e)}});if(a.ok){let e=await a.json();$(e)}}catch(e){console.error("Erro ao recarregar consulta:",e)}})()}}),"exames"===P&&W&&(0,r.jsx)(H,{consulta:{...W,id:W.id||l,paciente_id:W.paciente_id||(null===(a=W.paciente)||void 0===a?void 0:a.id),medico_id:W.medico_id||(null===(o=W.medico)||void 0===o?void 0:o.id)},inline:!0,onClose:()=>{},onSuccess:()=>{(async()=>{try{let e=localStorage.getItem("token"),a=await fetch("".concat("https://clamatec.com/api","/consultas/").concat(l),{headers:{Authorization:"Bearer ".concat(e)}});if(a.ok){let e=await a.json();$(e)}}catch(e){console.error("Erro ao recarregar consulta:",e)}})()}})]})]})})]})]})})}var es=t(4280),eo=t(5671);function ei(e){var a;let{isOpen:t,onClose:o,consultaId:i,pacienteNome:n,medicoNome:c,salaVideoconferencia:d,onAnamneseSaved:u}=e,m=(0,s.useRef)(null),x=(0,s.useRef)(null),h=(0,s.useRef)(null),p=(0,s.useRef)(null),[g,f]=(0,s.useState)(!0),[b,v]=(0,s.useState)(!0),[j,w]=(0,s.useState)(!1),[N,C]=(0,s.useState)(!1),[E,k]=(0,s.useState)(!1),[_,S]=(0,s.useState)(!1),[A,T]=(0,s.useState)(null),[D,P]=(0,s.useState)(""),[Z,z]=(0,s.useState)({queixa_principal:"",historia_doenca_atual:"",historia_patologica_pregressa:"",historia_familiar:"",historia_social:"",exame_fisico:"",pressao_arterial:"",frequencia_cardiaca:"",frequencia_respiratoria:"",temperatura:"",peso:"",altura:"",diagnostico:"",conduta:""}),I=(0,s.useCallback)(()=>navigator.mediaDevices&&navigator.mediaDevices.getUserMedia?window.isSecureContext||"https:"===window.location.protocol||"localhost"===window.location.hostname||"127.0.0.1"===window.location.hostname?{supported:!0}:{supported:!1,error:"Acesso \xe0 c\xe2mera e microfone requer HTTPS. Certifique-se de que o site est\xe1 usando uma conex\xe3o segura."}:{supported:!1,error:"Seu navegador n\xe3o suporta acesso \xe0 c\xe2mera e microfone. Use Chrome, Firefox, Edge ou Safari atualizado."},[]),R=(0,s.useCallback)(async()=>{try{var e;C(!0),T(null),P("");let a=I();if(!a.supported){T(a.error||"Navegador n\xe3o suportado"),P("NotSupportedError"),l.A.error(a.error||"Navegador n\xe3o suportado"),C(!1);return}console.log("Solicitando permiss\xe3o de c\xe2mera e microfone..."),console.log("navigator.mediaDevices dispon\xedvel:",!!navigator.mediaDevices),console.log("getUserMedia dispon\xedvel:",!!(null===(e=navigator.mediaDevices)||void 0===e?void 0:e.getUserMedia));let t=await navigator.mediaDevices.getUserMedia({video:!0,audio:!0});console.log("Stream recebido, aplicando constraints de qualidade..."),console.log("Permiss\xe3o concedida! Stream recebido:",t),console.log("Tracks no stream:",t.getTracks().map(e=>({kind:e.kind,id:e.id,enabled:e.enabled,readyState:e.readyState}))),h.current=t,setTimeout(()=>{m.current?(console.log("Atribuindo stream ao elemento de v\xeddeo local"),m.current.srcObject=t,m.current.play().catch(e=>{console.error("Erro ao reproduzir v\xeddeo local:",e)})):console.warn("Elemento de v\xeddeo local n\xe3o encontrado!")},100),f(!0),v(!0),S(!0),p.current?(console.log("Adicionando tracks ao PeerConnection existente..."),t.getTracks().forEach(e=>{p.current.getSenders().map(e=>e.track).includes(e)||(console.log("Adicionando track ao PeerConnection:",e.kind,e.id),p.current.addTrack(e,t))}),console.log("Tracks no PeerConnection ap\xf3s adicionar:",p.current.getSenders().length)):(console.log("Criando PeerConnection ap\xf3s obter stream..."),O()),l.A.success("C\xe2mera e microfone ativados!")}catch(t){console.error("Erro ao acessar c\xe2mera/microfone:",t),console.error("Detalhes do erro:",{name:t.name,message:t.message,constraint:t.constraint}),S(!1);let e="Erro ao acessar c\xe2mera ou microfone",a="";"NotAllowedError"===t.name||"PermissionDeniedError"===t.name?(e="Permiss\xe3o negada",a="NotAllowedError"):"NotFoundError"===t.name||"DevicesNotFoundError"===t.name?(e="C\xe2mera ou microfone n\xe3o encontrados",a="NotFoundError"):"NotReadableError"===t.name||"TrackStartError"===t.name?(e="Dispositivo em uso por outro aplicativo",a="NotReadableError"):"OverconstrainedError"===t.name?(e="Configura\xe7\xe3o de v\xeddeo n\xe3o suportada",a="OverconstrainedError"):(e=t.message||"Erro desconhecido ao acessar dispositivos",a="UnknownError"),T(e),P(a),l.A.error(e)}finally{C(!1)}},[I]),O=(0,s.useCallback)(()=>{let e=new RTCPeerConnection({iceServers:[{urls:"stun:stun.l.google.com:19302"},{urls:"stun:stun1.l.google.com:19302"}]});h.current&&h.current.getTracks().forEach(a=>{e.addTrack(a,h.current)}),e.ontrack=e=>{x.current&&(x.current.srcObject=e.streams[0])},e.onicecandidate=async e=>{if(e.candidate)try{let a=localStorage.getItem("token"),t=d||"webrtc-consulta-".concat(i);await fetch("".concat("https://clamatec.com/api","/webrtc/").concat(t,"/candidato"),{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(a)},body:JSON.stringify({candidate:e.candidate})})}catch(e){console.error("Erro ao enviar ICE candidate:",e)}},e.onconnectionstatechange=()=>{console.log("Estado da conex\xe3o:",e.connectionState),w("connected"===e.connectionState)},p.current=e},[i,d]),L=(0,s.useCallback)(async()=>{var e,a,t,r,s,o,n,c;if(console.log("startCall chamado!",{hasPeerConnection:!!p.current,consultaId:i,salaVideoconferencia:d,mediaPermissionGranted:_,hasLocalStream:!!h.current,tracksCount:(null===(e=h.current)||void 0===e?void 0:e.getTracks().length)||0}),!p.current){console.error("PeerConnection n\xe3o existe!"),l.A.error("Erro: Conex\xe3o WebRTC n\xe3o inicializada. Recarregue a p\xe1gina.");return}if(!_||!h.current){console.error("Permiss\xe3o de m\xeddia n\xe3o concedida ou stream n\xe3o dispon\xedvel!"),l.A.error("Por favor, permita acesso \xe0 c\xe2mera e microfone primeiro.");return}try{C(!0),console.log("Verificando tracks no PeerConnection...");let e=p.current.getSenders().map(e=>e.track),u=h.current.getTracks();console.log("Verificando tracks:",{existingTracksCount:e.length,streamTracksCount:u.length,streamTracks:u.map(e=>({kind:e.kind,id:e.id,enabled:e.enabled}))}),u.forEach(a=>{e.includes(a)||(console.log("Adicionando track:",a.kind,a.id),p.current.addTrack(a,h.current))}),await new Promise(e=>setTimeout(e,100));let m=p.current.getSenders();console.log("Tracks no PeerConnection ap\xf3s adicionar:",m.length),console.log("Detalhes dos tracks:",m.map(e=>{var a,t,r;return{kind:null===(a=e.track)||void 0===a?void 0:a.kind,id:null===(t=e.track)||void 0===t?void 0:t.id,enabled:null===(r=e.track)||void 0===r?void 0:r.enabled}}));let x=m.filter(e=>{var a;return(null===(a=e.track)||void 0===a?void 0:a.kind)==="audio"}),g=m.filter(e=>{var a;return(null===(a=e.track)||void 0===a?void 0:a.kind)==="video"});if(0===x.length||0===g.length){console.error("Tracks insuficientes!",{audio:x.length,video:g.length}),l.A.error("Erro: Tracks de \xe1udio/v\xeddeo n\xe3o foram adicionados corretamente. Tente novamente."),C(!1);return}console.log("Criando oferta com tracks:",{audio:x.length,video:g.length});let f=await p.current.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0});console.log("Oferta criada, verificando SDP:",{sdpLength:(null===(a=f.sdp)||void 0===a?void 0:a.length)||0,hasAudio:(null===(t=f.sdp)||void 0===t?void 0:t.includes("m=audio"))||!1,hasVideo:(null===(r=f.sdp)||void 0===r?void 0:r.includes("m=video"))||!1,hasApplication:(null===(s=f.sdp)||void 0===s?void 0:s.includes("m=application"))||!1});let b=f.sdp||"",v=b.split("\r\n"),j=[],y=!1,N=new Set,E=new Map,k=null;for(let e=0;e<v.length;e++){let a=v[e].trim();if(a.startsWith("m=audio")){k="audio";let e=a.match(/^m=\w+\s+\d+\s+\w+\/(\w+)\s+(.+)$/);if(e){let a=e[2].split(" ").map(e=>parseInt(e));E.set("audio",new Set(a))}}else if(a.startsWith("m=video")){k="video";let e=a.match(/^m=\w+\s+\d+\s+\w+\/(\w+)\s+(.+)$/);if(e){let a=e[2].split(" ").map(e=>parseInt(e));E.set("video",new Set(a))}}else a.startsWith("m=")&&(k=null);if(a.startsWith("a=rtpmap:")){let e=a.match(/^a=rtpmap:(\d+)\s+(.+)$/);if(e){let a=parseInt(e[1]),t=e[2];(t.includes("ulpfec")||t.includes("red/90000")||t.includes("rtx/90000"))&&N.add(a)}}}k=null;for(let e=0;e<v.length;e++){let a=v[e],t=a.trim();if(t.startsWith("a=group:BUNDLE")){let e=t.match(/a=group:BUNDLE\s+(.+)/);if(e){let a=e[1].split(" ").filter(e=>"2"!==e);j.push("a=group:BUNDLE ".concat(a.join(" ")))}else j.push(a);continue}if(t.startsWith("m=application")){y=!0,k=null;continue}if(t.startsWith("m=audio")){y=!1,k="audio";let e=t.match(/^(m=\w+\s+\d+\s+\w+\/(\w+)\s+)(.+)$/);if(e){let a=e[1],t=e[3].split(" ").filter(e=>{let a=parseInt(e.trim());return!isNaN(a)&&a>0&&!N.has(a)}).map(e=>parseInt(e.trim())),r=a+t.join(" ");j.push(r),E.set("audio",new Set(t))}else j.push(a);continue}if(t.startsWith("m=video")){y=!1,k="video";let e=t.match(/^(m=\w+\s+\d+\s+\w+\/(\w+)\s+)(.+)$/);if(e){let a=e[1],t=e[3].split(" ").filter(e=>{let a=parseInt(e.trim());return!isNaN(a)&&a>0&&!N.has(a)}).map(e=>parseInt(e.trim())),r=a+t.join(" ");j.push(r),E.set("video",new Set(t))}else j.push(a);continue}if(t.startsWith("m=")){y=!1,k=null,j.push(a);continue}if(!(y||t.startsWith("a=max-message-size:")||t.startsWith("a=sctp-port:")||t.startsWith("a=ssrc:")||t.startsWith("a=ssrc-group:")||t.includes("ulpfec")||t.includes("red/90000")||t.includes("rtx/90000"))){if(t.startsWith("a=rtpmap:")){let e=t.match(/^a=rtpmap:(\d+)/);if(e){let a=parseInt(e[1]);if(N.has(a))continue;if(k&&E.has(k)){if(!E.get(k).has(a))continue}else if(!k)continue}}if(t.startsWith("a=fmtp:")){let e=t.match(/^a=fmtp:(\d+)/);if(e){let a=parseInt(e[1]);if(N.has(a))continue;if(t.includes("apt=")){let e=t.match(/apt=(\d+)/);if(e&&N.has(parseInt(e[1])))continue}if(k&&E.has(k)){if(!E.get(k).has(a))continue}else if(!k)continue}}if(t.startsWith("a=rtcp-fb:")){let e=t.match(/^a=rtcp-fb:(\d+)/);if(e){let a=parseInt(e[1]);if(N.has(a))continue;if(k&&E.has(k)){if(!E.get(k).has(a))continue}else if(!k)continue}}j.push(a)}}b=j.join("\r\n");let _={type:f.type,sdp:b};console.log("Oferta criada:",{type:_.type,sdpLength:(null===(o=_.sdp)||void 0===o?void 0:o.length)||0,sdpPreview:(null===(n=_.sdp)||void 0===n?void 0:n.substring(0,100))||"",originalSdpLength:(null===(c=f.sdp)||void 0===c?void 0:c.length)||0}),await p.current.setLocalDescription(_),console.log("Local description definida");let S=localStorage.getItem("token"),A=d||"webrtc-consulta-".concat(i);console.log("Enviando oferta para roomId:",A),console.log("URL:","".concat("https://clamatec.com/api","/webrtc/").concat(A,"/oferta"));let T=await fetch("".concat("https://clamatec.com/api","/webrtc/").concat(A,"/oferta"),{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(S)},body:JSON.stringify({offer:{type:f.type,sdp:f.sdp},consulta_id:i})});if(console.log("Resposta do servidor:",{status:T.status,statusText:T.statusText,ok:T.ok}),T.ok){let e=await T.json();console.log("Resposta do servidor (dados):",e),l.A.success("Chamada iniciada! Aguardando paciente conectar...");let a=setInterval(async()=>{try{let e=await fetch("".concat("https://clamatec.com/api","/webrtc/").concat(A,"/resposta"),{headers:{Authorization:"Bearer ".concat(S)}});if(e.ok){let t=await e.json();if(console.log("Verificando resposta:",t),t.answer&&p.current){console.log("Resposta encontrada! Conectando...");let e=t.answer.sdp||"",r=e.split("\r\n"),s=[],o=!1,i=new Set,n=new Set;for(let e=0;e<r.length;e++){let a=r[e].trim();if(a.startsWith("a=rtpmap:")){let e=a.match(/^a=rtpmap:(\d+)\s+(.+)$/);if(e){let a=parseInt(e[1]),t=e[2];t.includes("ulpfec")||t.includes("red/90000")||t.includes("rtx/90000")?i.add(a):n.add(a)}}}for(let e=0;e<r.length;e++){let a=r[e],t=a.trim();if(t.startsWith("a=group:BUNDLE")){let e=t.match(/a=group:BUNDLE\s+(.+)/);if(e){let a=e[1].split(" ").filter(e=>"2"!==e);s.push("a=group:BUNDLE ".concat(a.join(" ")))}else s.push(a);continue}if(t.startsWith("m=application")){o=!0;continue}if(t.startsWith("m=")&&!t.startsWith("m=application")){o=!1;let e=t.match(/^(m=\w+\s+\d+\s+\w+\/(\w+)\s+)(.+)$/);if(e){let a=e[1],t=e[3].split(" ").filter(e=>{let a=parseInt(e);return!i.has(a)});s.push(a+t.join(" "))}else s.push(a);continue}if(!(o||t.startsWith("a=max-message-size:")||t.startsWith("a=sctp-port:")||t.startsWith("a=ssrc:")||t.startsWith("a=ssrc-group:")||t.includes("ulpfec")||t.includes("red/90000")||t.includes("rtx/90000"))){if(t.startsWith("a=rtpmap:")){let e=t.match(/^a=rtpmap:(\d+)/);if(e&&i.has(parseInt(e[1])))continue}if(t.startsWith("a=fmtp:")){let e=t.match(/^a=fmtp:(\d+)/);if(e){let a=parseInt(e[1]);if(i.has(a))continue;if(t.includes("apt=")){let e=t.match(/apt=(\d+)/);if(e&&i.has(parseInt(e[1])))continue}if(!n.has(a))continue}}if(t.startsWith("a=rtcp-fb:")){let e=t.match(/^a=rtcp-fb:(\d+)/);if(e&&i.has(parseInt(e[1])))continue}s.push(a)}}e=(e=s.join("\r\n")).replace(/\r\n/g,"\n").replace(/\r/g,"\n").replace(/\n/g,"\r\n");let c={type:t.answer.type,sdp:e};await p.current.setRemoteDescription(new RTCSessionDescription(c)),clearInterval(a),w(!0),l.A.success("Paciente conectado!")}}}catch(e){console.error("Erro ao verificar resposta:",e)}},2e3);setTimeout(()=>clearInterval(a),3e5)}else{let e=await T.json().catch(()=>({message:"Erro ao iniciar chamada"}));console.error("Erro na resposta:",T.status,e),l.A.error(e.message||"Erro ao iniciar chamada (".concat(T.status,")"))}}catch(e){console.error("Erro ao iniciar chamada:",e),console.error("Stack trace:",e.stack),l.A.error("Erro ao iniciar chamada: "+(e.message||"Erro desconhecido"))}finally{C(!1)}},[i,d,_]),q=(0,s.useCallback)(()=>{if(h.current){let e=h.current.getVideoTracks()[0];e&&(e.enabled=!g,f(!g))}},[g]),B=(0,s.useCallback)(()=>{if(h.current){let e=h.current.getAudioTracks()[0];e&&(e.enabled=!b,v(!b))}},[b]),W=(0,s.useCallback)(()=>{h.current&&(h.current.getTracks().forEach(e=>e.stop()),h.current=null),p.current&&(p.current.close(),p.current=null),w(!1)},[]),V=(0,s.useCallback)(async()=>{try{k(!0);let e=localStorage.getItem("token"),a=await fetch("".concat("https://clamatec.com/api","/consultas/").concat(i),{method:"PUT",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(e)},body:JSON.stringify(Z)});if(a.ok)l.A.success("Anamnese salva com sucesso!"),u&&u();else{let e=await a.json();l.A.error(e.message||"Erro ao salvar anamnese")}}catch(e){console.error("Erro ao salvar anamnese:",e),l.A.error("Erro ao salvar anamnese")}finally{k(!1)}},[i,Z,u]),H=(0,s.useCallback)(async()=>{if(j)try{let e=localStorage.getItem("token");await fetch("".concat("https://clamatec.com/api","/consultas/").concat(i),{method:"PUT",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(e)},body:JSON.stringify({anamnese:Z})})}catch(e){console.error("Erro ao sincronizar anamnese:",e)}},[Z,j,i]);return((0,s.useEffect)(()=>{if(t&&!_){let e=I();e.supported||(T(e.error||"Navegador n\xe3o suportado"),P("NotSupportedError"))}},[t,_,I]),(0,s.useEffect)(()=>{if(!t){h.current&&(h.current.getTracks().forEach(e=>e.stop()),h.current=null),p.current&&(p.current.close(),p.current=null),w(!1),S(!1),T(null),P("");return}return p.current||O(),()=>{h.current&&(h.current.getTracks().forEach(e=>e.stop()),h.current=null),p.current&&(p.current.close(),p.current=null)}},[t,O]),(0,s.useEffect)(()=>{if(j){let e=setTimeout(()=>{H()},1e3);return()=>clearTimeout(e)}},[Z,j,H]),t)?(0,r.jsx)("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/90",children:(0,r.jsxs)("div",{className:"relative w-full h-full flex flex-col bg-gray-900",children:[(0,r.jsxs)("div",{className:"absolute top-0 left-0 right-0 z-10 bg-gradient-to-b from-black/90 to-transparent px-6 py-4 flex items-center justify-between",children:[(0,r.jsxs)("div",{className:"flex items-center gap-4",children:[(0,r.jsx)(y.Z,{className:"w-6 h-6 text-white"}),(0,r.jsxs)("div",{children:[(0,r.jsx)("h2",{className:"text-white font-semibold text-lg",children:"Consulta Online"}),(0,r.jsxs)("p",{className:"text-gray-300 text-sm",children:[c," ↔ ",n]})]})]}),(0,r.jsx)("button",{onClick:()=>{W(),o()},className:"text-white hover:text-gray-300 transition-colors p-2 hover:bg-white/10 rounded-lg",title:"Fechar",children:(0,r.jsx)(M.Z,{className:"w-6 h-6"})})]}),(0,r.jsxs)("div",{className:"flex-1 flex overflow-hidden pt-20",children:[(0,r.jsxs)("div",{className:"flex-1 flex flex-col items-center justify-center bg-black p-4",children:[!_&&(0,r.jsxs)("div",{className:"flex flex-col items-center justify-center text-center text-white max-w-2xl px-4",children:[(0,r.jsx)("div",{className:"rounded-full p-6 mb-6 ".concat(A?"bg-red-600/20":"bg-blue-600/20"),children:A?(0,r.jsx)(F.Z,{className:"w-16 h-16 text-red-400"}):(0,r.jsx)(y.Z,{className:"w-16 h-16"})}),(0,r.jsx)("h3",{className:"text-2xl font-bold mb-4",children:A?"Permiss\xe3o Necess\xe1ria":"Permiss\xe3o de C\xe2mera e Microfone"}),(0,r.jsx)("p",{className:"text-gray-300 mb-4",children:A?"Para iniciar a consulta online, precisamos de acesso \xe0 sua c\xe2mera e microfone.":"Para iniciar a consulta online, precisamos de acesso \xe0 sua c\xe2mera e microfone. Clique no bot\xe3o abaixo para permitir o acesso."}),!A&&(0,r.jsx)("div",{className:"bg-blue-900/30 border border-blue-500 rounded-lg p-3 mb-6 text-left max-w-xl w-full",children:(0,r.jsxs)("p",{className:"text-blue-200 text-sm",children:[(0,r.jsx)("strong",{children:"\uD83D\uDCA1 Importante:"}),' Ao clicar em "Permitir Acesso", o navegador mostrar\xe1 um popup pedindo permiss\xe3o. Se o popup n\xe3o aparecer, verifique as configura\xe7\xf5es do navegador ou recarregue a p\xe1gina.']})}),A&&(0,r.jsxs)("div",{className:"bg-red-900/30 border-2 border-red-500 rounded-lg p-5 mb-6 text-left max-w-xl w-full",children:[(0,r.jsxs)("div",{className:"flex items-start gap-3 mb-3",children:[(0,r.jsx)(F.Z,{className:"w-5 h-5 text-red-400 mt-0.5 flex-shrink-0"}),(0,r.jsx)("p",{className:"text-red-200 font-semibold",children:A})]}),"NotAllowedError"===D&&(0,r.jsxs)("div",{className:"text-red-300 text-sm space-y-3 ml-8",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("p",{className:"font-semibold mb-2",children:"Como permitir o acesso:"}),(0,r.jsxs)("ul",{className:"list-disc list-inside space-y-2 ml-2",children:[(0,r.jsxs)("li",{children:[(0,r.jsx)("strong",{children:"Chrome/Edge:"})," Clique no \xedcone de cadeado (\uD83D\uDD12) na barra de endere\xe7os →",(0,r.jsx)("span",{className:"text-red-200",children:" C\xe2mera e Microfone → Permitir"})]}),(0,r.jsxs)("li",{children:[(0,r.jsx)("strong",{children:"Firefox:"})," Clique no \xedcone de escudo →",(0,r.jsx)("span",{className:"text-red-200",children:" Permiss\xf5es → Permitir c\xe2mera e microfone"})]}),(0,r.jsxs)("li",{children:[(0,r.jsx)("strong",{children:"Safari:"})," Safari → Prefer\xeancias → Websites →",(0,r.jsx)("span",{className:"text-red-200",children:" C\xe2mera/Microfone → Permitir"})]})]})]}),(0,r.jsx)("div",{className:"pt-2 border-t border-red-700",children:(0,r.jsxs)("p",{className:"flex items-center gap-2",children:[(0,r.jsx)("span",{children:"\uD83D\uDCA1"}),(0,r.jsxs)("span",{children:[(0,r.jsx)("strong",{children:"Dica:"}),' Ap\xf3s alterar as configura\xe7\xf5es, clique em "Tentar Novamente" abaixo.']})]})})]}),"NotFoundError"===D&&(0,r.jsx)("p",{className:"text-red-300 text-sm ml-8",children:"Verifique se os dispositivos est\xe3o conectados e funcionando corretamente."}),"NotReadableError"===D&&(0,r.jsx)("p",{className:"text-red-300 text-sm ml-8",children:"Feche outros aplicativos que possam estar usando a c\xe2mera ou microfone e tente novamente."})]}),(0,r.jsxs)("div",{className:"flex flex-col sm:flex-row gap-4 w-full max-w-xl",children:[(0,r.jsx)("button",{onClick:R,disabled:N,className:"flex-1 px-8 py-4 bg-blue-600 hover:bg-blue-700 text-white rounded-lg transition-colors disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-3 text-lg font-semibold",children:N?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(J.Z,{className:"w-6 h-6 animate-spin"}),"Solicitando permiss\xe3o..."]}):(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(y.Z,{className:"w-6 h-6"}),A?"Tentar Novamente":"Permitir Acesso"]})}),A&&(0,r.jsxs)("button",{onClick:()=>window.location.reload(),className:"px-6 py-4 bg-gray-700 hover:bg-gray-600 text-white rounded-lg transition-colors flex items-center justify-center gap-2",title:"Recarregar p\xe1gina",children:[(0,r.jsx)(es.Z,{className:"w-5 h-5"}),"Recarregar"]})]})]}),_&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)("div",{className:"relative w-full max-w-4xl aspect-video bg-gray-800 rounded-lg overflow-hidden mb-4",children:[(0,r.jsx)("video",{ref:x,autoPlay:!0,playsInline:!0,className:"w-full h-full object-cover"}),!j&&(0,r.jsx)("div",{className:"absolute inset-0 flex items-center justify-center bg-gray-900/80",children:(0,r.jsxs)("div",{className:"text-center text-white",children:[(0,r.jsx)(J.Z,{className:"w-12 h-12 animate-spin mx-auto mb-4"}),(0,r.jsx)("p",{children:"Aguardando conex\xe3o com paciente..."})]})})]}),(0,r.jsxs)("div",{className:"relative w-64 aspect-video bg-gray-800 rounded-lg overflow-hidden border-2 border-white/20",children:[(0,r.jsx)("video",{ref:m,autoPlay:!0,playsInline:!0,muted:!0,className:"w-full h-full object-cover",style:{display:(null===(a=m.current)||void 0===a?void 0:a.srcObject)?"block":"none"},onLoadedMetadata:()=>{console.log("Metadados do v\xeddeo local carregados"),m.current&&m.current.play().catch(e=>{console.error("Erro ao reproduzir v\xeddeo local ap\xf3s metadata:",e)})},onPlay:()=>{console.log("V\xeddeo local come\xe7ou a reproduzir"),m.current&&(m.current.style.display="block")},onError:e=>{console.error("Erro no elemento de v\xeddeo local:",e)}}),!g&&(0,r.jsx)("div",{className:"absolute inset-0 flex items-center justify-center bg-gray-900 z-10",children:(0,r.jsx)(ea.Z,{className:"w-8 h-8 text-gray-500"})}),(!m.current||!m.current.srcObject)&&(0,r.jsx)("div",{className:"absolute inset-0 flex items-center justify-center bg-gray-900 z-10",children:(0,r.jsxs)("div",{className:"text-center text-white text-sm",children:[(0,r.jsx)(J.Z,{className:"w-8 h-8 animate-spin mx-auto mb-2"}),(0,r.jsx)("p",{children:"Aguardando c\xe2mera..."}),(0,r.jsx)("p",{className:"text-xs mt-2 text-gray-400",children:"Certifique-se de permitir o acesso"})]})})]})]}),_&&(0,r.jsxs)("div",{className:"flex items-center gap-4 mt-4",children:[(0,r.jsx)("button",{onClick:q,className:"p-3 rounded-full transition-colors ".concat(g?"bg-gray-700 hover:bg-gray-600 text-white":"bg-red-600 hover:bg-red-700 text-white"),title:g?"Desligar v\xeddeo":"Ligar v\xeddeo",children:g?(0,r.jsx)(y.Z,{className:"w-5 h-5"}):(0,r.jsx)(ea.Z,{className:"w-5 h-5"})}),(0,r.jsx)("button",{onClick:B,className:"p-3 rounded-full transition-colors ".concat(b?"bg-gray-700 hover:bg-gray-600 text-white":"bg-red-600 hover:bg-red-700 text-white"),title:b?"Desligar microfone":"Ligar microfone",children:b?(0,r.jsx)(ee.Z,{className:"w-5 h-5"}):(0,r.jsx)(X.Z,{className:"w-5 h-5"})}),!j&&(0,r.jsx)("button",{onClick:()=>{console.log("Bot\xe3o Iniciar Chamada clicado!"),L()},disabled:N||!p.current||!_,className:"px-6 py-3 bg-green-600 hover:bg-green-700 text-white rounded-lg transition-colors disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-2",title:p.current?_?"Iniciar chamada com paciente":"Permita acesso \xe0 c\xe2mera e microfone primeiro":"Aguardando inicializa\xe7\xe3o...",children:N?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(J.Z,{className:"w-5 h-5 animate-spin"}),"Conectando..."]}):(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(y.Z,{className:"w-5 h-5"}),"Iniciar Chamada"]})}),j&&(0,r.jsxs)("div",{className:"px-6 py-3 bg-green-600 text-white rounded-lg flex items-center gap-2",children:[(0,r.jsx)("div",{className:"w-3 h-3 bg-green-300 rounded-full animate-pulse"}),"Conectado"]}),(0,r.jsx)("button",{onClick:()=>{W(),o()},className:"p-3 bg-red-600 hover:bg-red-700 text-white rounded-full transition-colors",title:"Encerrar chamada",children:(0,r.jsx)(eo.Z,{className:"w-5 h-5"})})]})]}),(0,r.jsxs)("div",{className:"w-96 bg-white overflow-y-auto",children:[(0,r.jsxs)("div",{className:"sticky top-0 bg-white border-b border-gray-200 px-6 py-4 z-10",children:[(0,r.jsx)("h3",{className:"text-lg font-bold text-gray-900",children:"Anamnese"}),(0,r.jsx)("p",{className:"text-sm text-gray-600",children:"Preencha durante a consulta"})]}),(0,r.jsxs)("div",{className:"p-6 space-y-4",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Queixa Principal"}),(0,r.jsx)("textarea",{value:Z.queixa_principal,onChange:e=>z({...Z,queixa_principal:e.target.value}),rows:3,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500",placeholder:"Descreva a queixa principal do paciente..."})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Hist\xf3ria da Doen\xe7a Atual"}),(0,r.jsx)("textarea",{value:Z.historia_doenca_atual,onChange:e=>z({...Z,historia_doenca_atual:e.target.value}),rows:3,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500",placeholder:"Hist\xf3ria da doen\xe7a atual..."})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Hist\xf3ria Patol\xf3gica Pregressa"}),(0,r.jsx)("textarea",{value:Z.historia_patologica_pregressa,onChange:e=>z({...Z,historia_patologica_pregressa:e.target.value}),rows:2,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500",placeholder:"Hist\xf3ria patol\xf3gica pregressa..."})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Hist\xf3ria Familiar"}),(0,r.jsx)("textarea",{value:Z.historia_familiar,onChange:e=>z({...Z,historia_familiar:e.target.value}),rows:2,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500",placeholder:"Hist\xf3ria familiar..."})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Hist\xf3ria Social"}),(0,r.jsx)("textarea",{value:Z.historia_social,onChange:e=>z({...Z,historia_social:e.target.value}),rows:2,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500",placeholder:"Hist\xf3ria social..."})]}),(0,r.jsxs)("div",{className:"grid grid-cols-2 gap-3",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Press\xe3o Arterial"}),(0,r.jsx)("input",{type:"text",value:Z.pressao_arterial,onChange:e=>z({...Z,pressao_arterial:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500",placeholder:"Ex: 120/80"})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"FC (bpm)"}),(0,r.jsx)("input",{type:"text",value:Z.frequencia_cardiaca,onChange:e=>z({...Z,frequencia_cardiaca:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500",placeholder:"Ex: 72"})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"FR (rpm)"}),(0,r.jsx)("input",{type:"text",value:Z.frequencia_respiratoria,onChange:e=>z({...Z,frequencia_respiratoria:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500",placeholder:"Ex: 16"})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Temperatura (\xb0C)"}),(0,r.jsx)("input",{type:"text",value:Z.temperatura,onChange:e=>z({...Z,temperatura:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500",placeholder:"Ex: 36.5"})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Peso (kg)"}),(0,r.jsx)("input",{type:"text",value:Z.peso,onChange:e=>z({...Z,peso:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500",placeholder:"Ex: 70"})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Altura (cm)"}),(0,r.jsx)("input",{type:"text",value:Z.altura,onChange:e=>z({...Z,altura:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500",placeholder:"Ex: 175"})]})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Exame F\xedsico"}),(0,r.jsx)("textarea",{value:Z.exame_fisico,onChange:e=>z({...Z,exame_fisico:e.target.value}),rows:3,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500",placeholder:"Achados do exame f\xedsico..."})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Diagn\xf3stico"}),(0,r.jsx)("textarea",{value:Z.diagnostico,onChange:e=>z({...Z,diagnostico:e.target.value}),rows:2,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500",placeholder:"Diagn\xf3stico..."})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Conduta"}),(0,r.jsx)("textarea",{value:Z.conduta,onChange:e=>z({...Z,conduta:e.target.value}),rows:3,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500",placeholder:"Conduta m\xe9dica..."})]}),(0,r.jsx)("button",{onClick:V,disabled:E,className:"w-full px-6 py-3 bg-purple-600 hover:bg-purple-700 text-white rounded-lg transition-colors disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2 font-semibold",children:E?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(J.Z,{className:"w-5 h-5 animate-spin"}),"Salvando..."]}):(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(U.Z,{className:"w-5 h-5"}),"Salvar Anamnese"]})})]})]})]})]})}):null}var en=t(3930);function el(){var e,a;let{token:t}=(0,o.a)(),[i,O]=(0,s.useState)([]),[L,F]=(0,s.useState)(!0),[U,J]=(0,s.useState)(""),[$,Q]=(0,s.useState)({status:"",data:"",medico_id:""}),[X,ee]=(0,s.useState)([]),[ea,et]=(0,s.useState)({field:"data_consulta",direction:"desc"}),[es,eo]=(0,s.useState)(!1),[el,ec]=(0,s.useState)(!1),[ed,eu]=(0,s.useState)(!1),[em,ex]=(0,s.useState)(!1),[eh,ep]=(0,s.useState)(!1),[eg,ef]=(0,s.useState)(null),[eb,ev]=(0,s.useState)(null),[ej,ey]=(0,s.useState)(null),[ew,eN]=(0,s.useState)(null),[eC,eE]=(0,s.useState)(null),[ek,e_]=(0,s.useState)({isOpen:!1,id:null}),[eS,eA]=(0,s.useState)(!1),[eT,eD]=(0,s.useState)(!1),[eP,eZ]=(0,s.useState)(1),[ez,eI]=(0,s.useState)(null),[eR,eM]=(0,s.useState)(!1),[eO,eL]=(0,s.useState)(null),[eF,eU]=(0,s.useState)({tipo_atestado:"saude",dias_afastamento:"",cid:"",observacoes:""}),[eq,eB]=(0,s.useState)(!1),[eW,eV]=(0,s.useState)(null),[eJ,eH]=(0,s.useState)(!1),[eG,e$]=(0,s.useState)(null),[eY,eK]=(0,s.useState)(!0),[eQ,eX]=(0,s.useState)(!1),[e0,e1]=(0,s.useState)(null);(0,s.useEffect)(()=>{let e=async()=>{try{let e=await fetch("".concat("https://clamatec.com/api","/medicos"),{headers:{Authorization:"Bearer ".concat(t)}});if(e.ok){let a=await e.json(),t=Array.isArray(a)?a:a.data||[];console.log("M\xe9dicos carregados:",t),ee(t),0===t.length&&console.warn("Nenhum m\xe9dico encontrado no banco de dados")}else{let a=await e.text();console.error("Erro ao buscar m\xe9dicos:",e.status,a),l.A.error("Erro ao carregar lista de m\xe9dicos")}}catch(t){var e,a,r;console.error("Erro ao buscar m\xe9dicos:",t),(null===(e=t.message)||void 0===e?void 0:e.includes("CERT"))||(null===(a=t.message)||void 0===a?void 0:a.includes("certificate"))||"TypeError"===t.name&&(null===(r=t.message)||void 0===r?void 0:r.includes("Failed to fetch"))?l.A.error('Erro de certificado SSL. Por favor, aceite o certificado no navegador (clique em "Avan\xe7ado" → "Continuar") e recarregue a p\xe1gina.'):l.A.error("Erro ao carregar lista de m\xe9dicos")}};t&&e()},[t]);let e2=(0,s.useCallback)(async()=>{try{F(!0);let e=new URLSearchParams;U&&e.append("search",U),$.status&&e.append("status",$.status),$.data&&e.append("data",$.data),$.medico_id&&e.append("medico_id",$.medico_id);let a="".concat("https://clamatec.com/api","/consultas").concat(e.toString()?"?"+e.toString():""),r=await fetch(a,{headers:{Authorization:"Bearer ".concat(t)}});if(r.ok){let e=await r.json();O(e.data||e||[])}else if(403===r.status)l.A.error("Acesso negado. Voc\xea n\xe3o tem permiss\xe3o para ver consultas.");else if(422===r.status){let e=await r.json().catch(()=>({})),a=e.errors?Object.values(e.errors).flat().join(", "):"Erro de valida\xe7\xe3o ao carregar consultas";l.A.error(a)}else l.A.error("Erro ao carregar consultas")}catch(t){var e,a,r;console.error("Erro ao buscar consultas:",t),(null===(e=t.message)||void 0===e?void 0:e.includes("CERT"))||(null===(a=t.message)||void 0===a?void 0:a.includes("certificate"))||"TypeError"===t.name&&(null===(r=t.message)||void 0===r?void 0:r.includes("Failed to fetch"))?l.A.error('Erro de certificado SSL. Por favor, aceite o certificado no navegador (clique em "Avan\xe7ado" → "Continuar") e recarregue a p\xe1gina.'):l.A.error("Erro ao carregar consultas")}finally{F(!1)}},[t,U,$]);(0,s.useEffect)(()=>{e2(),eZ(1)},[e2]),(0,s.useEffect)(()=>{let e=e=>{e.target.closest(".relative")||eI(null)};if(null!==ez)return document.addEventListener("mousedown",e),()=>document.removeEventListener("mousedown",e)},[ez]);let e5=async()=>{if(ek.id)try{(await fetch("".concat("https://clamatec.com/api","/consultas/").concat(ek.id),{method:"DELETE",headers:{Authorization:"Bearer ".concat(t)}})).ok?(l.A.success("Consulta exclu\xedda com sucesso!"),e2()):l.A.error("Erro ao excluir consulta")}catch(e){l.A.error("Erro ao excluir consulta")}finally{e_({isOpen:!1,id:null})}},e3=async()=>{if(!eS){eA(!0);return}try{eD(!0);let e=await fetch("".concat("https://clamatec.com/api","/consultas/all?confirm=true"),{method:"DELETE",headers:{Authorization:"Bearer ".concat(t)}});if(e.ok){let a=await e.json();l.A.success(a.message||"Todas as consultas foram exclu\xeddas com sucesso!"),e2()}else{let a=await e.json();l.A.error(a.message||"Erro ao excluir consultas")}}catch(e){l.A.error("Erro ao excluir consultas")}finally{eD(!1),eA(!1)}},e4=async(e,a)=>{try{(await fetch("".concat("https://clamatec.com/api","/consultas/").concat(e),{method:"PUT",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(t)},body:JSON.stringify({status:a})})).ok?(l.A.success("Status atualizado com sucesso!"),e2()):l.A.error("Erro ao atualizar status")}catch(e){l.A.error("Erro ao atualizar status")}},e6=async e=>{try{let r=await fetch("".concat("https://clamatec.com/api","/consultas/").concat(e,"/iniciar-online"),{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(t)}});if(r.ok){var a;let t=await r.json();l.A.success("Consulta online iniciada!"),e2();let s=i.find(a=>a.id===e)||t.consulta;e$({salaId:t.sala_id||"",nomeUsuario:(null==s?void 0:null===(a=s.medico)||void 0===a?void 0:a.nome)||"M\xe9dico",consultaId:e}),eH(!0)}else{let e=await r.json();l.A.error(e.message||"Erro ao iniciar consulta online")}}catch(e){l.A.error("Erro ao iniciar consulta online")}},e7=e=>{et({field:e,direction:ea.field===e&&"asc"===ea.direction?"desc":"asc"})},e9=[...i].sort((e,a)=>{var t,r,s,o,i,n,l,c;let d=e[ea.field],u=a[ea.field];return("data_consulta"===ea.field?(d=new Date(d).getTime(),u=new Date(u).getTime()):"tipo_consulta"===ea.field||"status"===ea.field?(d=(null==d?void 0:d.toLowerCase())||"",u=(null==u?void 0:u.toLowerCase())||""):"paciente"===ea.field?(d=(null===(r=e.paciente)||void 0===r?void 0:null===(t=r.nome)||void 0===t?void 0:t.toLowerCase())||"",u=(null===(o=a.paciente)||void 0===o?void 0:null===(s=o.nome)||void 0===s?void 0:s.toLowerCase())||""):"medico"===ea.field&&(d=(null===(n=e.medico)||void 0===n?void 0:null===(i=n.nome)||void 0===i?void 0:i.toLowerCase())||"",u=(null===(c=a.medico)||void 0===c?void 0:null===(l=c.nome)||void 0===l?void 0:l.toLowerCase())||""),null==d)?1:null==u?-1:d<u?"asc"===ea.direction?-1:1:d>u?"asc"===ea.direction?1:-1:0}),e8=e=>{let{field:a}=e;return ea.field!==a?null:"asc"===ea.direction?(0,r.jsx)(c.Z,{className:"w-4 h-4"}):(0,r.jsx)(d.Z,{className:"w-4 h-4"})},ae={total:i.length,agendadas:i.filter(e=>"agendada"===e.status).length,confirmadas:i.filter(e=>"confirmada"===e.status).length,realizadas:i.filter(e=>"realizada"===e.status).length},aa=e=>(0,r.jsx)("span",{className:"px-2 py-0.5 rounded text-xs font-medium ".concat({agendada:"bg-yellow-100 text-yellow-700",confirmada:"bg-blue-100 text-blue-700",realizada:"bg-green-100 text-green-700",cancelada:"bg-red-100 text-red-700"}[e]||"bg-gray-100 text-gray-700"),children:e.charAt(0).toUpperCase()+e.slice(1)});return(0,r.jsxs)("div",{className:"space-y-6",children:[(0,r.jsx)("div",{className:"bg-white rounded-lg border border-gray-200 p-6",children:(0,r.jsx)("div",{className:"flex items-center justify-between",children:(0,r.jsxs)("div",{children:[(0,r.jsx)("h1",{className:"text-3xl font-bold text-gray-900",children:"Consultas Externas"}),(0,r.jsx)("p",{className:"text-gray-600 mt-1",children:"Gerencie todas as consultas agendadas"})]})})}),(0,r.jsxs)("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-3",children:[(0,r.jsxs)("div",{className:"bg-white border border-gray-200 rounded-lg p-3",children:[(0,r.jsx)("div",{className:"text-xs text-gray-500 mb-1",children:"Total"}),(0,r.jsx)("div",{className:"text-lg font-semibold text-gray-900",children:ae.total})]}),(0,r.jsxs)("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-3",children:[(0,r.jsx)("div",{className:"text-xs text-yellow-700 mb-1",children:"Agendadas"}),(0,r.jsx)("div",{className:"text-lg font-semibold text-yellow-900",children:ae.agendadas})]}),(0,r.jsxs)("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-3",children:[(0,r.jsx)("div",{className:"text-xs text-blue-700 mb-1",children:"Confirmadas"}),(0,r.jsx)("div",{className:"text-lg font-semibold text-blue-900",children:ae.confirmadas})]}),(0,r.jsxs)("div",{className:"bg-green-50 border border-green-200 rounded-lg p-3",children:[(0,r.jsx)("div",{className:"text-xs text-green-700 mb-1",children:"Realizadas"}),(0,r.jsx)("div",{className:"text-lg font-semibold text-green-900",children:ae.realizadas})]})]}),(0,r.jsxs)("div",{className:"bg-white rounded-lg border border-gray-200 p-4",children:[(0,r.jsxs)("div",{className:"flex flex-col sm:flex-row gap-3",children:[(0,r.jsx)("div",{className:"flex-1",children:(0,r.jsxs)("div",{className:"relative",children:[(0,r.jsx)(u.Z,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-4 h-4"}),(0,r.jsx)("input",{type:"text",value:U,onChange:e=>J(e.target.value),placeholder:"Buscar por paciente, m\xe9dico ou tipo...",className:"w-full pl-9 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-1 focus:ring-green-500 focus:border-green-500 outline-none text-sm"})]})}),(0,r.jsxs)("div",{className:"flex gap-2 flex-wrap",children:[(0,r.jsxs)(q.Z,{value:$.status,onChange:e=>Q({...$,status:e.target.value}),icon:(0,r.jsx)(m.Z,{className:"w-4 h-4"}),children:[(0,r.jsx)("option",{value:"",children:"Todos os status"}),(0,r.jsx)("option",{value:"agendada",children:"Agendada"}),(0,r.jsx)("option",{value:"confirmada",children:"Confirmada"}),(0,r.jsx)("option",{value:"realizada",children:"Realizada"}),(0,r.jsx)("option",{value:"cancelada",children:"Cancelada"})]}),(0,r.jsxs)(q.Z,{value:$.medico_id,onChange:e=>Q({...$,medico_id:e.target.value}),icon:(0,r.jsx)(x.Z,{className:"w-4 h-4"}),children:[(0,r.jsx)("option",{value:"",children:"Todos os m\xe9dicos"}),X.length>0?X.map(e=>(0,r.jsxs)("option",{value:e.id,children:[e.nome," ",e.especialidade?"- ".concat(e.especialidade):""]},e.id)):(0,r.jsx)("option",{value:"",disabled:!0,children:"Nenhum m\xe9dico cadastrado"})]}),(0,r.jsx)("input",{type:"date",value:$.data,onChange:e=>Q({...$,data:e.target.value}),className:"px-3 py-2 border border-gray-300 rounded-lg focus:ring-1 focus:ring-green-500 focus:border-green-500 outline-none text-sm"}),(0,r.jsxs)("button",{onClick:()=>{ev(null),eo(!0)},className:"px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors text-sm font-medium flex items-center gap-1",children:[(0,r.jsx)(h.Z,{className:"w-4 h-4"}),"Nova"]}),i.length>0&&(0,r.jsx)("button",{onClick:e3,disabled:eT,className:"px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors text-sm font-medium flex items-center gap-1 disabled:opacity-50 disabled:cursor-not-allowed",title:"Apagar todas as consultas",children:eT?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("div",{className:"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin"}),"Apagando..."]}):(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(p.Z,{className:"w-4 h-4"}),"Apagar Todas"]})})]})]}),L?(0,r.jsxs)("div",{className:"text-center py-8",children:[(0,r.jsx)("div",{className:"inline-block animate-spin rounded-full h-8 w-8 border-2 border-green-600 border-t-transparent"}),(0,r.jsx)("p",{className:"mt-2 text-sm text-gray-600",children:"Carregando..."})]}):0===i.length?(0,r.jsxs)("div",{className:"bg-gray-50 rounded-lg p-8 text-center border border-gray-200",children:[(0,r.jsx)(g.Z,{className:"w-12 h-12 mx-auto mb-3 text-gray-400"}),(0,r.jsx)("p",{className:"text-sm text-gray-600",children:U||$.status||$.data||$.medico_id?"Nenhuma consulta encontrada":"Nenhuma consulta cadastrada"})]}):(0,r.jsxs)("div",{className:"bg-white rounded-lg border border-gray-200 overflow-hidden",children:[(0,r.jsx)("div",{className:"overflow-x-auto",children:(0,r.jsxs)("table",{className:"w-full",children:[(0,r.jsx)("thead",{className:"bg-gray-50 border-b border-gray-200",children:(0,r.jsxs)("tr",{children:[(0,r.jsx)("th",{className:"px-4 py-3 text-left",children:(0,r.jsxs)("button",{onClick:()=>e7("data_consulta"),className:"flex items-center gap-1 text-xs font-medium text-gray-700 uppercase hover:text-gray-900 transition-colors",children:["Data/Hora",(0,r.jsx)(e8,{field:"data_consulta"})]})}),(0,r.jsx)("th",{className:"px-4 py-3 text-left",children:(0,r.jsxs)("button",{onClick:()=>e7("tipo_consulta"),className:"flex items-center gap-1 text-xs font-medium text-gray-700 uppercase hover:text-gray-900 transition-colors",children:["Tipo",(0,r.jsx)(e8,{field:"tipo_consulta"})]})}),(0,r.jsx)("th",{className:"px-4 py-3 text-left",children:(0,r.jsxs)("button",{onClick:()=>e7("paciente"),className:"flex items-center gap-1 text-xs font-medium text-gray-700 uppercase hover:text-gray-900 transition-colors",children:["Paciente",(0,r.jsx)(e8,{field:"paciente"})]})}),(0,r.jsx)("th",{className:"px-4 py-3 text-left",children:(0,r.jsxs)("button",{onClick:()=>e7("medico"),className:"flex items-center gap-1 text-xs font-medium text-gray-700 uppercase hover:text-gray-900 transition-colors",children:["M\xe9dico",(0,r.jsx)(e8,{field:"medico"})]})}),(0,r.jsx)("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-700 uppercase",children:"Sala"}),(0,r.jsx)("th",{className:"px-4 py-3 text-left",children:(0,r.jsxs)("button",{onClick:()=>e7("status"),className:"flex items-center gap-1 text-xs font-medium text-gray-700 uppercase hover:text-gray-900 transition-colors",children:["Status",(0,r.jsx)(e8,{field:"status"})]})}),(0,r.jsx)("th",{className:"px-4 py-3 text-right text-xs font-medium text-gray-700 uppercase",children:"A\xe7\xf5es"})]})}),(0,r.jsx)("tbody",{className:"divide-y divide-gray-200",children:(()=>{e9.length;let e=(eP-1)*5;return e9.slice(e,e+5).map(e=>(0,r.jsxs)("tr",{className:"hover:bg-gray-50 transition-colors",children:[(0,r.jsx)("td",{className:"px-4 py-3",children:(0,r.jsxs)("div",{className:"text-sm",children:[(0,r.jsx)("div",{className:"font-medium text-gray-900",children:(0,n.p6)(e.data_consulta,"dd/MM/yyyy")}),(0,r.jsxs)("div",{className:"text-xs text-gray-500 flex items-center gap-1 mt-0.5",children:[(0,r.jsx)(f.Z,{className:"w-3 h-3"}),e.hora_consulta]})]})}),(0,r.jsx)("td",{className:"px-4 py-3",children:(0,r.jsx)("span",{className:"text-sm text-gray-900",children:e.tipo_consulta})}),(0,r.jsx)("td",{className:"px-4 py-3",children:e.paciente?(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsx)(b.Z,{className:"w-4 h-4 text-gray-400"}),(0,r.jsxs)("div",{children:[(0,r.jsx)("div",{className:"text-sm font-medium text-gray-900",children:e.paciente.nome}),(0,r.jsxs)("div",{className:"text-xs text-gray-500",children:["NIF: ",e.paciente.nif]})]})]}):(0,r.jsx)("span",{className:"text-xs text-gray-400",children:"-"})}),(0,r.jsx)("td",{className:"px-4 py-3",children:e.medico?(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsx)(x.Z,{className:"w-4 h-4 text-gray-400"}),(0,r.jsxs)("div",{children:[(0,r.jsx)("div",{className:"text-sm text-gray-900",children:e.medico.nome}),e.medico.especialidade&&(0,r.jsx)("div",{className:"text-xs text-gray-500",children:e.medico.especialidade})]})]}):(0,r.jsx)("span",{className:"text-xs text-gray-400",children:"-"})}),(0,r.jsx)("td",{className:"px-4 py-3",children:e.sala?(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsx)(v.Z,{className:"w-4 h-4 text-gray-400"}),(0,r.jsxs)("div",{children:[(0,r.jsx)("div",{className:"text-sm font-medium text-gray-900",children:e.sala.numero}),e.sala.nome&&(0,r.jsx)("div",{className:"text-xs text-gray-500",children:e.sala.nome})]})]}):(0,r.jsx)("span",{className:"text-xs text-gray-400",children:"-"})}),(0,r.jsx)("td",{className:"px-4 py-3",children:(0,r.jsxs)("div",{className:"flex items-center gap-2 flex-wrap",children:[aa(e.status),e.agendada_online&&(0,r.jsxs)("span",{className:"inline-flex items-center gap-1 px-2 py-0.5 rounded text-xs font-medium bg-purple-100 text-purple-700",title:"Agendada Online",children:[(0,r.jsx)(j.Z,{className:"w-3 h-3"}),"Online"]}),e.consulta_online&&(0,r.jsxs)("span",{className:"inline-flex items-center gap-1 px-2 py-0.5 rounded text-xs font-medium bg-blue-100 text-blue-700",title:"Consulta Online",children:[(0,r.jsx)(y.Z,{className:"w-3 h-3"}),"Video"]}),e.consulta_online&&("agendada"===e.status||"confirmada"===e.status)&&!e.link_videoconferencia&&(0,r.jsx)("button",{onClick:()=>e6(e.id),className:"p-1 text-blue-600 hover:text-blue-700 hover:bg-blue-50 rounded transition-colors",title:"Iniciar consulta online",children:(0,r.jsx)(y.Z,{className:"w-4 h-4"})}),e.sala_videoconferencia&&e.consulta_online&&(0,r.jsx)("button",{onClick:()=>{var a;e$({salaId:e.sala_videoconferencia||"",nomeUsuario:(null===(a=e.medico)||void 0===a?void 0:a.nome)||"M\xe9dico",consultaId:e.id}),eH(!0)},className:"p-1 text-green-600 hover:text-green-700 hover:bg-green-50 rounded transition-colors",title:"Acessar videoconfer\xeancia (como anfitri\xe3o)",children:(0,r.jsx)(y.Z,{className:"w-4 h-4"})}),"realizada"!==e.status&&(0,r.jsxs)(r.Fragment,{children:["agendada"===e.status&&(0,r.jsx)("button",{onClick:()=>e4(e.id,"confirmada"),className:"p-1 text-blue-600 hover:text-blue-700 hover:bg-blue-50 rounded transition-colors",title:"Confirmar",children:(0,r.jsx)(w.Z,{className:"w-4 h-4"})}),"confirmada"===e.status&&(0,r.jsx)("button",{onClick:()=>e4(e.id,"realizada"),className:"p-1 text-green-600 hover:text-green-700 hover:bg-green-50 rounded transition-colors",title:"Marcar como realizada",children:(0,r.jsx)(w.Z,{className:"w-4 h-4"})}),("agendada"===e.status||"confirmada"===e.status)&&(0,r.jsx)("button",{onClick:()=>e4(e.id,"cancelada"),className:"p-1 text-red-600 hover:text-red-700 hover:bg-red-50 rounded transition-colors",title:"Cancelar",children:(0,r.jsx)(N.Z,{className:"w-4 h-4"})})]})]})}),(0,r.jsx)("td",{className:"px-4 py-3",children:(0,r.jsxs)("div",{className:"flex items-center justify-end gap-1 flex-wrap",children:[(0,r.jsx)("button",{onClick:()=>{ey(e),ec(!0)},className:"p-1.5 text-gray-600 hover:text-blue-600 hover:bg-blue-50 rounded transition-colors",title:"Ver detalhes",children:(0,r.jsx)(C.Z,{className:"w-4 h-4"})}),"realizada"!==e.status&&"cancelada"!==e.status&&(0,r.jsx)("button",{onClick:()=>{eV(e),eB(!0)},className:"p-1.5 text-gray-600 hover:text-orange-600 hover:bg-orange-50 rounded transition-colors",title:"Transferir Vaga",children:(0,r.jsx)(E.Z,{className:"w-4 h-4"})}),(0,r.jsx)("button",{onClick:async()=>{try{let a="".concat("https://clamatec.com/api","/consultas/").concat(e.id,"/recibo"),r=await fetch(a,{method:"GET",headers:{Authorization:"Bearer ".concat(t)}});if(r.ok){let e=await r.blob(),a=window.URL.createObjectURL(e);window.open(a,"_blank"),setTimeout(()=>window.URL.revokeObjectURL(a),100),l.A.success("Recibo gerado!")}else l.A.error("Erro ao gerar recibo")}catch(e){console.error("Erro ao gerar recibo:",e),l.A.error("Erro ao gerar recibo")}},className:"p-1.5 text-gray-600 hover:text-orange-600 hover:bg-orange-50 rounded transition-colors",title:"Gerar Recibo",children:(0,r.jsx)(k.Z,{className:"w-4 h-4"})}),("confirmada"===e.status||"realizada"===e.status)&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("button",{onClick:()=>{eE(e),ep(!0)},className:"p-1.5 text-gray-600 hover:text-blue-600 hover:bg-blue-50 rounded transition-colors",title:"Emitir Prescri\xe7\xe3o M\xe9dica",children:(0,r.jsx)(_.Z,{className:"w-4 h-4"})}),e.prescricao&&(0,r.jsx)("button",{onClick:async()=>{try{let a="".concat("https://clamatec.com/api","/consultas/").concat(e.id,"/prescricao"),r=await fetch(a,{method:"GET",headers:{Authorization:"Bearer ".concat(t)}});if(r.ok){let e=await r.blob(),a=window.URL.createObjectURL(e);window.open(a,"_blank"),setTimeout(()=>window.URL.revokeObjectURL(a),100),l.A.success("Prescri\xe7\xe3o gerada!")}else{let e=await r.json().catch(()=>({message:"Erro ao gerar prescri\xe7\xe3o"}));l.A.error(e.message||"Erro ao gerar prescri\xe7\xe3o")}}catch(e){console.error("Erro ao gerar prescri\xe7\xe3o:",e),l.A.error("Erro ao gerar prescri\xe7\xe3o")}},className:"p-1.5 text-gray-600 hover:text-green-600 hover:bg-green-50 rounded transition-colors",title:"Visualizar Prescri\xe7\xe3o PDF",children:(0,r.jsx)(S.Z,{className:"w-4 h-4"})}),(0,r.jsx)("button",{onClick:()=>{eL(e),eM(!0)},className:"p-1.5 text-gray-600 hover:text-purple-600 hover:bg-purple-50 rounded transition-colors",title:"Emitir Atestado M\xe9dico",children:(0,r.jsx)(A.Z,{className:"w-4 h-4"})}),"realizada"!==e.status&&(0,r.jsx)("button",{onClick:()=>{eN(e),eu(!0)},className:"p-1.5 text-gray-600 hover:text-purple-600 hover:bg-purple-50 rounded transition-colors",title:"Anamnese",children:(0,r.jsx)(T.Z,{className:"w-4 h-4"})}),"realizada"!==e.status&&(0,r.jsx)("button",{onClick:()=>{ef(e),ex(!0)},className:"p-1.5 text-gray-600 hover:text-blue-600 hover:bg-blue-50 rounded transition-colors",title:"Solicitar Exame",children:(0,r.jsx)(D.Z,{className:"w-4 h-4"})}),("confirmada"===e.status||"realizada"===e.status)&&(0,r.jsx)("button",{onClick:async()=>{try{let a="".concat("https://clamatec.com/api","/consultas/").concat(e.id,"/requisicao-exames"),r=await fetch(a,{method:"GET",headers:{Authorization:"Bearer ".concat(t)}});if(r.ok){let e=await r.blob(),a=window.URL.createObjectURL(e);window.open(a,"_blank"),setTimeout(()=>window.URL.revokeObjectURL(a),100),l.A.success("Requisi\xe7\xe3o de exames gerada!")}else{let e=await r.json().catch(()=>({message:"Erro ao gerar requisi\xe7\xe3o de exames"}));l.A.error(e.message||"Erro ao gerar requisi\xe7\xe3o de exames")}}catch(e){console.error("Erro ao gerar requisi\xe7\xe3o de exames:",e),l.A.error("Erro ao gerar requisi\xe7\xe3o de exames")}},className:"p-1.5 text-gray-600 hover:text-indigo-600 hover:bg-indigo-50 rounded transition-colors",title:"Gerar Requisi\xe7\xe3o de Exames",children:(0,r.jsx)(S.Z,{className:"w-4 h-4"})})]}),"realizada"!==e.status&&(0,r.jsx)("button",{onClick:()=>{ev(e),eo(!0)},className:"p-1.5 text-gray-600 hover:text-green-600 hover:bg-green-50 rounded transition-colors",title:"Editar",children:(0,r.jsx)(P.Z,{className:"w-4 h-4"})}),(0,r.jsx)("button",{onClick:()=>e_({isOpen:!0,id:e.id}),className:"p-1.5 text-gray-600 hover:text-red-600 hover:bg-red-50 rounded transition-colors",title:"Excluir",children:(0,r.jsx)(p.Z,{className:"w-4 h-4"})}),(0,r.jsxs)("div",{className:"relative",children:[(0,r.jsx)("button",{onClick:()=>eI(ez===e.id?null:e.id),className:"p-1.5 text-gray-600 hover:text-green-600 hover:bg-green-50 rounded transition-colors relative",title:"Mais Documentos",children:(0,r.jsx)(Z.Z,{className:"w-4 h-4"})}),ez===e.id&&(0,r.jsx)("div",{className:"absolute right-0 top-full mt-1 bg-white border border-gray-200 rounded-lg shadow-lg z-50 min-w-[180px]",children:(0,r.jsxs)("div",{className:"py-1",children:[(0,r.jsxs)("button",{onClick:async()=>{try{let a="".concat("https://clamatec.com/api","/consultas/").concat(e.id,"/recibo"),r=await fetch(a,{method:"GET",headers:{Authorization:"Bearer ".concat(t)}});if(r.ok){let e=await r.blob(),a=window.URL.createObjectURL(e);window.open(a,"_blank"),setTimeout(()=>window.URL.revokeObjectURL(a),100),eI(null),l.A.success("Recibo gerado!")}}catch(e){console.error("Erro ao gerar recibo:",e),l.A.error("Erro ao gerar recibo")}},className:"w-full px-3 py-2 text-left text-xs text-gray-700 hover:bg-gray-50 flex items-center gap-2",children:[(0,r.jsx)(S.Z,{className:"w-3.5 h-3.5"}),"Recibo"]}),(0,r.jsxs)("button",{onClick:()=>{eL(e),eM(!0),eI(null)},className:"w-full px-3 py-2 text-left text-xs text-gray-700 hover:bg-gray-50 flex items-center gap-2",children:[(0,r.jsx)(A.Z,{className:"w-3.5 h-3.5"}),"Atestado"]}),(0,r.jsxs)("button",{onClick:async()=>{try{let a="".concat("https://clamatec.com/api","/consultas/").concat(e.id,"/relatorio"),r=await fetch(a,{method:"GET",headers:{Authorization:"Bearer ".concat(t)}});if(r.ok){let e=await r.blob(),a=window.URL.createObjectURL(e);window.open(a,"_blank"),setTimeout(()=>window.URL.revokeObjectURL(a),100),eI(null),l.A.success("Relat\xf3rio gerado!")}}catch(e){console.error("Erro ao gerar relat\xf3rio:",e),l.A.error("Erro ao gerar relat\xf3rio")}},className:"w-full px-3 py-2 text-left text-xs text-gray-700 hover:bg-gray-50 flex items-center gap-2",children:[(0,r.jsx)(T.Z,{className:"w-3.5 h-3.5"}),"Relat\xf3rio"]}),(0,r.jsxs)("button",{onClick:async()=>{try{let a="".concat("https://clamatec.com/api","/consultas/").concat(e.id,"/comprovante"),r=await fetch(a,{method:"GET",headers:{Authorization:"Bearer ".concat(t)}});if(r.ok){let e=await r.blob(),a=window.URL.createObjectURL(e);window.open(a,"_blank"),setTimeout(()=>window.URL.revokeObjectURL(a),100),eI(null),l.A.success("Comprovante gerado!")}}catch(e){console.error("Erro ao gerar comprovante:",e),l.A.error("Erro ao gerar comprovante")}},className:"w-full px-3 py-2 text-left text-xs text-gray-700 hover:bg-gray-50 flex items-center gap-2",children:[(0,r.jsx)(k.Z,{className:"w-3.5 h-3.5"}),"Comprovante"]})]})})]})]})})]},e.id))})()})]})}),(0,r.jsx)("div",{className:"bg-gray-50 px-4 py-3 border-t border-gray-200",children:(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsxs)("p",{className:"text-xs text-gray-600",children:["Mostrando ",(0,r.jsx)("span",{className:"font-medium text-gray-900",children:Math.min((eP-1)*5+1,e9.length)})," - ",(0,r.jsx)("span",{className:"font-medium text-gray-900",children:Math.min(5*eP,e9.length)})," de ",(0,r.jsx)("span",{className:"font-medium text-gray-900",children:e9.length})," consulta",1!==e9.length?"s":""]}),(()=>{let e=Math.ceil(e9.length/5);return e<=1?null:(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsxs)("button",{onClick:()=>eZ(Math.max(1,eP-1)),disabled:1===eP,className:"flex items-center gap-1 px-3 py-1.5 rounded-md text-sm font-medium transition-colors ".concat(1===eP?"bg-gray-100 text-gray-400 cursor-not-allowed":"bg-white text-gray-700 border border-gray-300 hover:bg-gray-50"),children:[(0,r.jsx)(z.Z,{className:"w-4 h-4"}),"Anterior"]}),(0,r.jsx)("div",{className:"flex items-center gap-1",children:Array.from({length:Math.min(e,7)},(a,t)=>{let s;return s=e<=7?t+1:eP<=4?t+1:eP>=e-3?e-6+t:eP-3+t,(0,r.jsx)("button",{onClick:()=>eZ(s),className:"px-3 py-1.5 rounded-md text-sm font-medium transition-colors ".concat(eP===s?"bg-green-600 text-white":"bg-white text-gray-700 border border-gray-300 hover:bg-gray-50"),children:s},s)})}),(0,r.jsxs)("span",{className:"text-sm text-gray-600 px-2",children:["de ",e]}),(0,r.jsxs)("button",{onClick:()=>eZ(Math.min(e,eP+1)),disabled:eP===e,className:"flex items-center gap-1 px-3 py-1.5 rounded-md text-sm font-medium transition-colors ".concat(eP===e?"bg-gray-100 text-gray-400 cursor-not-allowed":"bg-white text-gray-700 border border-gray-300 hover:bg-gray-50"),children:["Pr\xf3xima",(0,r.jsx)(I.Z,{className:"w-4 h-4"})]})]})})()]})})]})]}),es&&(0,r.jsx)(B,{consulta:eb,onClose:()=>{eo(!1),ev(null)},onSuccess:()=>{eo(!1),ev(null),e2()}}),el&&ej&&(0,r.jsx)(W.Z,{consulta:ej,onClose:()=>{ec(!1),ey(null)},onEdit:()=>{ec(!1),ev(ej),eo(!0)},onStatusChange:e=>{e4(ej.id,e),ec(!1),ey(null)}}),ed&&ew&&(0,r.jsx)(V.Z,{consulta:ew,onClose:()=>{eu(!1),eN(null)},onSuccess:()=>{eu(!1),eN(null),e2()}}),em&&eg&&(0,r.jsx)(H,{consulta:eg,onClose:()=>{ex(!1),ef(null)},onSuccess:()=>{ex(!1),ef(null),e2()}}),eh&&eC&&(0,r.jsx)(G.Z,{consulta:eC,onClose:()=>{ep(!1),eE(null)},onSuccess:()=>{ep(!1),eE(null),e2()}}),eq&&eW&&(0,r.jsx)(Y,{consulta:eW,onClose:()=>{eB(!1),eV(null)},onSuccess:()=>{eB(!1),eV(null),e2()}}),eJ&&eG&&eY&&(0,r.jsx)(er,{isOpen:eJ,onClose:()=>{eH(!1),e$(null)},consultaId:eG.consultaId,nomeUsuario:eG.nomeUsuario,isMedico:!0}),eJ&&eG&&!eY&&(0,r.jsx)(K,{isOpen:eJ,onClose:()=>{eH(!1),e$(null)},salaId:eG.salaId,nomeUsuario:eG.nomeUsuario,isMedico:!0}),eQ&&e0&&(0,r.jsx)(ei,{isOpen:eQ,onClose:()=>{eX(!1),e1(null)},consultaId:e0.id,pacienteNome:(null===(e=e0.paciente)||void 0===e?void 0:e.nome)||"Paciente",medicoNome:(null===(a=e0.medico)||void 0===a?void 0:a.nome)||"M\xe9dico",salaVideoconferencia:e0.sala_videoconferencia,onAnamneseSaved:()=>{e2()}}),(0,r.jsx)(en.Z,{isOpen:ek.isOpen,title:"Confirmar Exclus\xe3o",message:"Tem certeza que deseja excluir esta consulta? Esta a\xe7\xe3o n\xe3o pode ser desfeita.",confirmText:"Excluir",cancelText:"Cancelar",type:"danger",onConfirm:e5,onCancel:()=>e_({isOpen:!1,id:null})}),eS&&(0,r.jsx)("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/50 backdrop-blur-sm",children:(0,r.jsx)("div",{className:"bg-white rounded-xl shadow-2xl max-w-md w-full border-2 border-red-200",children:(0,r.jsxs)("div",{className:"p-6",children:[(0,r.jsxs)("div",{className:"flex items-start gap-4 mb-4",children:[(0,r.jsx)("div",{className:"flex-shrink-0 text-red-600",children:(0,r.jsx)(R.Z,{className:"w-6 h-6"})}),(0,r.jsxs)("div",{className:"flex-1",children:[(0,r.jsx)("h3",{className:"text-lg font-bold text-gray-900 mb-2",children:"⚠️ Confirmar Exclus\xe3o de TODAS as Consultas"}),(0,r.jsxs)("div",{className:"space-y-2 text-sm",children:[(0,r.jsxs)("p",{className:"font-semibold text-red-600",children:["ATEN\xc7\xc3O: Esta a\xe7\xe3o ir\xe1 apagar TODAS as ",i.length," consultas do sistema!"]}),(0,r.jsx)("p",{className:"text-gray-600",children:"Esta a\xe7\xe3o \xe9 irrevers\xedvel e n\xe3o pode ser desfeita. Todas as consultas, incluindo hist\xf3ricos m\xe9dicos, ser\xe3o permanentemente removidas."}),(0,r.jsx)("p",{className:"text-gray-800 font-medium mt-4",children:"Tem certeza que deseja continuar?"})]})]}),(0,r.jsx)("button",{onClick:()=>eA(!1),className:"flex-shrink-0 text-gray-400 hover:text-gray-600 transition-colors",children:(0,r.jsx)(M.Z,{className:"w-5 h-5"})})]}),(0,r.jsxs)("div",{className:"flex gap-3 justify-end",children:[(0,r.jsx)("button",{onClick:()=>eA(!1),className:"px-4 py-2 border-2 border-gray-300 rounded-lg hover:bg-gray-50 transition-colors font-semibold text-gray-700",children:"Cancelar"}),(0,r.jsx)("button",{onClick:e3,disabled:eT,className:"px-4 py-2 bg-red-600 hover:bg-red-700 text-white rounded-lg transition-colors font-semibold shadow-sm disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-2",children:eT?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("div",{className:"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin"}),"Apagando..."]}):"Confirmar e Apagar Tudo"})]})]})})}),eR&&eO&&(0,r.jsx)("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/50",children:(0,r.jsxs)("div",{className:"bg-white rounded-lg shadow-lg max-w-md w-full p-6",children:[(0,r.jsx)("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Gerar Atestado M\xe9dico"}),(0,r.jsxs)("div",{className:"space-y-4",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Tipo de Atestado"}),(0,r.jsxs)("select",{value:eF.tipo_atestado,onChange:e=>eU({...eF,tipo_atestado:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-1 focus:ring-green-500 focus:border-green-500 outline-none text-sm",children:[(0,r.jsx)("option",{value:"saude",children:"Atestado de Sa\xfade"}),(0,r.jsx)("option",{value:"doenca",children:"Atestado de Doen\xe7a"}),(0,r.jsx)("option",{value:"comparecimento",children:"Atestado de Comparecimento"})]})]}),"doenca"===eF.tipo_atestado&&(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Dias de Afastamento"}),(0,r.jsx)("input",{type:"number",value:eF.dias_afastamento,onChange:e=>eU({...eF,dias_afastamento:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-1 focus:ring-green-500 focus:border-green-500 outline-none text-sm",min:"0"})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"CID (Opcional)"}),(0,r.jsx)("input",{type:"text",value:eF.cid,onChange:e=>eU({...eF,cid:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-1 focus:ring-green-500 focus:border-green-500 outline-none text-sm",placeholder:"Ex: A00.0"})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Observa\xe7\xf5es (Opcional)"}),(0,r.jsx)("textarea",{value:eF.observacoes,onChange:e=>eU({...eF,observacoes:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-1 focus:ring-green-500 focus:border-green-500 outline-none text-sm",rows:3,placeholder:"Observa\xe7\xf5es adicionais..."})]})]}),(0,r.jsxs)("div",{className:"flex gap-2 mt-6",children:[(0,r.jsx)("button",{onClick:async()=>{try{let e="".concat("https://clamatec.com/api","/consultas/").concat(eO.id,"/atestado"),a={tipo_atestado:eF.tipo_atestado};eF.dias_afastamento&&""!==eF.dias_afastamento.trim()&&(a.dias_afastamento=eF.dias_afastamento),eF.cid&&""!==eF.cid.trim()&&(a.cid=eF.cid.trim()),eF.observacoes&&""!==eF.observacoes.trim()&&(a.observacoes=eF.observacoes.trim());let r=await fetch(e,{method:"POST",headers:{Authorization:"Bearer ".concat(t),"Content-Type":"application/json"},body:JSON.stringify(a)});if(r.ok){let e=await r.blob(),a=window.URL.createObjectURL(e);window.open(a,"_blank"),setTimeout(()=>window.URL.revokeObjectURL(a),100),eM(!1),eL(null),eU({tipo_atestado:"saude",dias_afastamento:"",cid:"",observacoes:""}),l.A.success("Atestado gerado!")}else{let e=await r.json().catch(()=>({message:"Erro ao gerar atestado"}));l.A.error(e.message||"Erro ao gerar atestado")}}catch(e){console.error("Erro ao gerar atestado:",e),l.A.error("Erro ao gerar atestado")}},className:"flex-1 px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition-colors text-sm font-medium",children:"Gerar Atestado"}),(0,r.jsx)("button",{onClick:()=>{eM(!1),eL(null),eU({tipo_atestado:"saude",dias_afastamento:"",cid:"",observacoes:""})},className:"px-4 py-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 transition-colors text-sm font-medium",children:"Cancelar"})]})]})})]})}function ec(){let{user:e,loading:a}=(0,o.a)(),t=(0,i.useRouter)();return((0,s.useEffect)(()=>{a||e||t.push("/gestao/login")},[e,a,t]),a)?(0,r.jsx)("div",{className:"flex items-center justify-center min-h-screen",children:(0,r.jsx)(J.Z,{className:"w-8 h-8 animate-spin text-green-600"})}):(0,r.jsx)("div",{className:"min-h-screen bg-gray-50",children:(0,r.jsx)("div",{className:"max-w-[95rem] mx-auto px-4 sm:px-6 lg:px-8 py-8",children:(0,r.jsx)(el,{})})})}},3930:function(e,a,t){"use strict";t.d(a,{Z:function(){return i}});var r=t(7437),s=t(2894),o=t(2549);function i(e){let{isOpen:a,title:t,message:i,confirmText:n="Confirmar",cancelText:l="Cancelar",onConfirm:c,onCancel:d,type:u="danger"}=e;if(!a)return null;let m=(()=>{switch(u){case"danger":return{button:"bg-red-600 hover:bg-red-700 text-white",icon:"text-red-600",border:"border-red-200"};case"warning":return{button:"bg-yellow-600 hover:bg-yellow-700 text-white",icon:"text-yellow-600",border:"border-yellow-200"};default:return{button:"bg-blue-600 hover:bg-blue-700 text-white",icon:"text-blue-600",border:"border-blue-200"}}})();return(0,r.jsx)("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/50 backdrop-blur-sm animate-in fade-in duration-200",children:(0,r.jsx)("div",{className:"bg-white rounded-xl shadow-2xl max-w-md w-full border-2 border-gray-200 animate-in zoom-in-95 duration-200",children:(0,r.jsxs)("div",{className:"p-6",children:[(0,r.jsxs)("div",{className:"flex items-start gap-4 mb-4",children:[(0,r.jsx)("div",{className:"flex-shrink-0 ".concat(m.icon),children:(0,r.jsx)(s.Z,{className:"w-6 h-6"})}),(0,r.jsxs)("div",{className:"flex-1",children:[(0,r.jsx)("h3",{className:"text-lg font-bold text-gray-900 mb-2",children:t}),(0,r.jsx)("p",{className:"text-sm text-gray-600",children:i})]}),(0,r.jsx)("button",{onClick:d,className:"flex-shrink-0 text-gray-400 hover:text-gray-600 transition-colors",children:(0,r.jsx)(o.Z,{className:"w-5 h-5"})})]}),(0,r.jsxs)("div",{className:"flex gap-3 justify-end",children:[(0,r.jsx)("button",{onClick:d,className:"px-4 py-2 border-2 border-gray-300 rounded-lg hover:bg-gray-50 transition-colors font-semibold text-gray-700",children:l}),(0,r.jsx)("button",{onClick:c,className:"px-4 py-2 rounded-lg transition-colors font-semibold shadow-sm ".concat(m.button),children:n})]})]})})})}},100:function(e,a,t){"use strict";t.d(a,{_:function(){return o}});let r=null,s=!1,o={hasActiveInstance:()=>null!==r,registerInstance(e){if(r&&r!==e){console.warn("J\xe1 existe uma inst\xe2ncia ativa, destruindo antes de registrar nova...");try{r.destroy()}catch(e){console.warn("Erro ao destruir inst\xe2ncia anterior:",e)}}r=e},unregisterInstance(e){r===e&&(r=null)},async destroyActiveInstance(){if(r){try{await r.destroy()}catch(e){console.warn("Erro ao destruir inst\xe2ncia ativa:",e)}r=null}try{if(window.DailyIframe){let e=window.DailyIframe;if(e._instances&&Array.isArray(e._instances)){for(let a of[...e._instances])try{a&&"function"==typeof a.destroy&&await a.destroy()}catch(e){}e._instances=[]}}}catch(e){console.warn("Erro ao limpar inst\xe2ncias globais:",e)}},isCreating:()=>s,setCreating(e){s=e},getActiveInstance:()=>r}}},function(e){e.O(0,[3803,8481,2806,6568,1834,2971,4938,1744],function(){return e(e.s=8330)}),_N_E=e.O()}]);